<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Network Pro - شبكتي المتطورة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1877f2;
            --primary-dark: #166fe5;
            --secondary: #42b72a;
            --secondary-dark: #36a420;
            --accent: #f02849;
            --accent-light: #ffe6ea;
            --warning: #f7b928;
            --success: #45bd62;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --sidebar-bg: #ffffff;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --text-light: #8a8d91;
            --border-color: #dddfe2;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-elevated: 0 12px 28px rgba(0, 0, 0, 0.2);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --primary: #2d88ff;
            --primary-dark: #1a7cff;
            --secondary: #31a24c;
            --secondary-dark: #2a8c40;
            --accent: #f02849;
            --accent-light: #3e1a21;
            --warning: #e0ac00;
            --success: #2d9c47;
            --bg-color: #18191a;
            --card-bg: #242526;
            --sidebar-bg: #242526;
            --text-primary: #e4e6eb;
            --text-secondary: #b0b3b8;
            --text-light: #8a8d91;
            --border-color: #3e4042;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.4);
            --shadow-elevated: 0 12px 28px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            direction: rtl;
            min-height: 100vh;
            transition: var(--transition);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }

        .loading-logo {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 18px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Header */
        .header {
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 0 16px;
            backdrop-filter: blur(10px);
            background-color: rgba(var(--card-bg-rgb), 0.9);
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            height: 60px;
            gap: 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--primary);
        }

        .logo-icon {
            font-size: 32px;
            position: relative;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-bar {
            flex: 1;
            max-width: 680px;
            margin: 0 20px;
            position: relative;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            border-radius: 50px;
            border: 2px solid transparent;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-size: 15px;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            background-color: var(--card-bg);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-elevated);
            margin-top: 10px;
            display: none;
            z-index: 1001;
            max-height: 400px;
            overflow-y: auto;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:hover {
            background: var(--bg-color);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background-color: var(--bg-color);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .icon-btn.active {
            color: var(--primary);
            background: var(--bg-color);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: var(--accent);
            color: white;
            font-size: 11px;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .user-avatar:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .dropdown-menu {
            position: absolute;
            top: 50px;
            left: 0;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-elevated);
            min-width: 280px;
            display: none;
            z-index: 1001;
            overflow: hidden;
        }

        .dropdown-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-header-info h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .dropdown-header-info p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            text-decoration: none;
            color: var(--text-primary);
            transition: var(--transition);
            border: none;
            background: none;
            width: 100%;
            text-align: right;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background-color: var(--bg-color);
        }

        .dropdown-item i {
            width: 20px;
            color: var(--text-secondary);
            font-size: 18px;
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 80px auto 20px;
            gap: 24px;
            padding: 0 20px;
        }

        /* Left Sidebar */
        .sidebar {
            width: 320px;
            flex-shrink: 0;
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--text-secondary) transparent;
        }

        .profile-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .profile-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .profile-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            z-index: 0;
        }

        .profile-content {
            position: relative;
            z-index: 1;
            margin-top: 40px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--card-bg);
            margin: 0 auto 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: var(--transition);
        }

        .profile-avatar:hover {
            transform: scale(1.05);
        }

        .profile-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .profile-bio {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            max-height: 42px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            padding: 8px;
            border-radius: var(--radius-sm);
        }

        .stat-item:hover {
            background: var(--bg-color);
        }

        .stat-number {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
            display: block;
            line-height: 1;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .sidebar-nav {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .nav-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 8px;
        }

        .nav-title i {
            font-size: 18px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
            margin-bottom: 4px;
            cursor: pointer;
            position: relative;
        }

        .nav-item:hover {
            background-color: var(--bg-color);
            transform: translateX(-4px);
        }

        .nav-item.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .nav-item.active i {
            color: white;
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 24px;
            background: var(--primary);
            border-radius: 2px;
        }

        .nav-item i {
            font-size: 20px;
            width: 24px;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .nav-badge {
            margin-right: auto;
            background: var(--accent);
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        .shortcuts {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
            margin-bottom: 8px;
        }

        .shortcut-item:hover {
            background: var(--bg-color);
        }

        .shortcut-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--primary);
        }

        /* Feed */
        .feed {
            flex: 1;
            min-width: 0;
            max-width: 680px;
        }

        /* Story Section */
        .stories-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .stories-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stories-title {
            font-size: 18px;
            font-weight: 700;
        }

        .watch-all {
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }

        .stories-container {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 8px;
            scrollbar-width: none;
        }

        .stories-container::-webkit-scrollbar {
            display: none;
        }

        .story {
            flex: 0 0 120px;
            height: 200px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .story:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-hover);
        }

        .story.create-story {
            background: var(--bg-color);
            border: 2px dashed var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .add-story {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 12px;
        }

        .create-story-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
        }

        .story-content {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .story-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .story-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 16px;
            color: white;
        }

        .story-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid var(--primary);
            margin-bottom: 8px;
        }

        .story-username {
            font-size: 13px;
            font-weight: 600;
            display: block;
        }

        /* Create Post */
        .create-post-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .create-post-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .create-post-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .create-post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .post-input-container {
            flex: 1;
            position: relative;
        }

        .post-input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 25px;
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            transition: var(--transition);
            min-height: 48px;
            max-height: 200px;
            overflow-y: auto;
        }

        .post-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card-bg);
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .post-input::placeholder {
            color: var(--text-secondary);
        }

        .post-preview {
            margin-top: 20px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            display: none;
        }

        .post-preview.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .post-preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: var(--radius);
        }

        .remove-preview {
            position: absolute;
            top: 12px;
            left: 12px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0,0,0,0.6);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .remove-preview:hover {
            background: rgba(0,0,0,0.8);
            transform: scale(1.1);
        }

        .post-actions {
            display: flex;
            gap: 12px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .post-action-btn {
            flex: 1;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            border: none;
            background: var(--bg-color);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .post-action-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .post-action-btn i {
            font-size: 18px;
        }

        .post-action-btn.photo i { color: #45bd62; }
        .post-action-btn.feeling i { color: #f7b928; }
        .post-action-btn.tag i { color: #1877f2; }
        .post-action-btn.poll i { color: #e41e3f; }
        .post-action-btn.live i { color: #f02849; }

        .post-privacy {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            margin-top: 16px;
            transition: var(--transition);
        }

        .post-privacy:hover {
            background: var(--border-color);
        }

        .post-submit {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: none;
            background: var(--primary);
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .post-submit:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .post-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Posts */
        .posts-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .post-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .post-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .post-card.pinned::before {
            content: 'مثبت';
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--warning);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
        }

        .post-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .post-user {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
            transition: var(--transition);
            cursor: pointer;
        }

        .post-avatar:hover {
            transform: scale(1.1);
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-info h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .post-user-info h3:hover {
            text-decoration: underline;
        }

        .post-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .post-time {
            cursor: pointer;
        }

        .post-time:hover {
            text-decoration: underline;
        }

        .post-privacy-icon {
            font-size: 12px;
        }

        .post-options {
            position: relative;
        }

        .post-options-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-options-btn:hover {
            background: var(--bg-color);
            color: var(--text-primary);
        }

        .post-options-menu {
            position: absolute;
            top: 40px;
            left: 0;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-elevated);
            min-width: 200px;
            display: none;
            z-index: 10;
        }

        .post-options-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .post-content {
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .post-content a {
            color: var(--primary);
            text-decoration: none;
        }

        .post-content a:hover {
            text-decoration: underline;
        }

        .post-media {
            margin-bottom: 20px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
        }

        .post-media img, .post-media video {
            width: 100%;
            max-height: 600px;
            object-fit: cover;
            display: block;
            cursor: pointer;
        }

        .media-indicators {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
        }

        .media-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: var(--transition);
        }

        .media-indicator.active {
            background: white;
            transform: scale(1.2);
        }

        .media-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
        }

        .post-media:hover .media-nav {
            opacity: 1;
        }

        .media-prev {
            right: 16px;
        }

        .media-next {
            left: 16px;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 14px;
        }

        .post-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .post-stat:hover {
            text-decoration: underline;
        }

        .post-actions-buttons {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .post-action-btn-large {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .post-action-btn-large:hover {
            background: var(--bg-color);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .post-action-btn-large.active {
            color: var(--primary);
        }

        .post-action-btn-large.active i {
            color: var(--primary);
        }

        .comments-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .comment-form {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-input-container {
            flex: 1;
            position: relative;
        }

        .comment-input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            border-radius: 25px;
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            transition: var(--transition);
            min-height: 40px;
            max-height: 100px;
            overflow-y: auto;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card-bg);
        }

        .comment-submit {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .comment-submit:hover {
            background: var(--primary-dark);
            transform: translateY(-50%) scale(1.1);
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .comment {
            display: flex;
            gap: 12px;
        }

        .comment-content {
            flex: 1;
            background: var(--bg-color);
            padding: 12px 16px;
            border-radius: var(--radius);
            position: relative;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
        }

        .comment-author:hover {
            text-decoration: underline;
        }

        .comment-time {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.5;
        }

        .comment-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .comment-action {
            cursor: pointer;
            transition: var(--transition);
        }

        .comment-action:hover {
            color: var(--primary);
        }

        .comment-like.active {
            color: var(--accent);
            font-weight: 600;
        }

        .load-more-comments {
            text-align: center;
            padding: 12px;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .load-more-comments:hover {
            background: var(--bg-color);
        }

        /* Right Sidebar */
        .right-sidebar {
            width: 320px;
            flex-shrink: 0;
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--text-secondary) transparent;
        }

        .widget {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .widget:hover {
            box-shadow: var(--shadow-hover);
        }

        .widget-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .widget-title i {
            color: var(--primary);
            font-size: 20px;
        }

        .widget-action {
            color: var(--primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .widget-action:hover {
            text-decoration: underline;
        }

        .birthday-item, .contact-item, .group-item, .event-item, .sponsored-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            cursor: pointer;
            margin-bottom: 8px;
        }

        .birthday-item:hover, .contact-item:hover, .group-item:hover, .event-item:hover, .sponsored-item:hover {
            background: var(--bg-color);
        }

        .birthday-avatar, .contact-avatar, .group-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .group-avatar {
            border-radius: 12px;
        }

        .birthday-info, .contact-info, .group-info, .event-info, .sponsored-info {
            flex: 1;
            min-width: 0;
        }

        .birthday-info h4, .contact-info h4, .group-info h4, .event-info h4, .sponsored-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .birthday-info p, .contact-info p, .group-info p, .event-info p, .sponsored-info p {
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .online-dot {
            width: 10px;
            height: 10px;
            background-color: var(--success);
            border-radius: 50%;
            margin-left: 8px;
            flex-shrink: 0;
        }

        .event-date {
            background: var(--primary);
            color: white;
            padding: 8px;
            border-radius: var(--radius-sm);
            text-align: center;
            min-width: 60px;
            flex-shrink: 0;
        }

        .event-day {
            font-size: 18px;
            font-weight: 700;
            display: block;
        }

        .event-month {
            font-size: 12px;
            display: block;
        }

        .sponsored-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
        }

        .trending-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .trending-item {
            padding: 12px;
            border-radius: var(--radius-sm);
            background: var(--bg-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .trending-item:hover {
            background: var(--border-color);
        }

        .trending-category {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .trending-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .trending-count {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Chat Widget */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 300px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-elevated);
            z-index: 999;
            overflow: hidden;
            display: none;
        }

        .chat-widget.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-header {
            padding: 16px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            font-size: 16px;
            font-weight: 700;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-close:hover {
            transform: scale(1.1);
        }

        .chat-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-item:hover {
            background: var(--bg-color);
        }

        .chat-item.unread .chat-info h4 {
            font-weight: 700;
        }

        .chat-item.unread .chat-message {
            color: var(--text-primary);
            font-weight: 600;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-info h4 {
            font-size: 14px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-message {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideUp 0.3s ease;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--card-bg);
            z-index: 1;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--text-primary);
            background: var(--bg-color);
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-primary);
            font-size: 15px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card-bg);
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: left 16px center;
            background-size: 16px;
            padding-left: 40px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .form-checkbox input {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            cursor: pointer;
        }

        .form-checkbox input:checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .form-radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .form-radio {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .form-radio input {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            cursor: pointer;
        }

        .form-radio input:checked {
            border-color: var(--primary);
            background: var(--primary);
        }

        .form-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .btn {
            flex: 1;
            padding: 16px;
            border-radius: var(--radius-sm);
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--accent);
            color: white;
        }

        .btn-danger:hover {
            background: #d4203a;
            transform: translateY(-2px);
        }

        .btn-block {
            width: 100%;
        }

        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 40px;
            width: 100%;
            max-width: 440px;
            box-shadow: var(--shadow-elevated);
            text-align: center;
            animation: slideUp 0.5s ease;
        }

        .login-logo {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }

        .login-logo::after {
            content: '';
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 16px;
            line-height: 1.5;
        }

        .login-form .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .social-login {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .social-btn:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .social-btn.google i {
            color: #DB4437;
        }

        .social-btn.facebook i {
            color: #1877f2;
        }

        .social-btn.twitter i {
            color: #1DA1F2;
        }

        .login-divider {
            display: flex;
            align-items: center;
            margin: 24px 0;
            color: var(--text-secondary);
        }

        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }

        .login-divider span {
            padding: 0 16px;
            font-size: 14px;
        }

        .forgot-password {
            display: block;
            text-align: center;
            color: var(--primary);
            text-decoration: none;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition);
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .register-link {
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .register-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .toast {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px 20px;
            box-shadow: var(--shadow-elevated);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            border-right: 4px solid var(--primary);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-right-color: var(--success);
        }

        .toast.error {
            border-right-color: var(--accent);
        }

        .toast.warning {
            border-right-color: var(--warning);
        }

        .toast.info {
            border-right-color: var(--primary);
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--accent);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--primary);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .toast-message {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            transition: var(--transition);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-close:hover {
            color: var(--text-primary);
            background: var(--bg-color);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .right-sidebar {
                display: none;
            }
            
            .main-container {
                max-width: 800px;
            }
        }

        @media (max-width: 992px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
                height: auto;
                margin-bottom: 24px;
            }
            
            .header-container {
                gap: 12px;
            }
            
            .search-bar {
                display: none;
            }
            
            .header-controls .icon-btn span {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                padding: 0 12px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .main-container {
                padding: 0 12px;
                margin-top: 70px;
            }
            
            .create-post-card,
            .post-card,
            .stories-section,
            .widget {
                padding: 20px;
            }
            
            .post-actions {
                flex-direction: column;
            }
            
            .post-action-btn {
                min-width: 100%;
            }
            
            .modal-content {
                margin: 12px;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .profile-stats {
                flex-direction: column;
                gap: 16px;
            }
            
            .stat-item {
                width: 100%;
            }
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: var(--transition);
            border-radius: 34px;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .theme-slider {
            background-color: var(--primary);
        }

        input:checked + .theme-slider:before {
            transform: translateX(30px);
            background-color: var(--text-primary);
        }

        .theme-slider i {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
        }

        .theme-slider .fa-sun {
            right: 8px;
            color: #f7b928;
        }

        .theme-slider .fa-moon {
            left: 8px;
            color: #8a8d91;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }

        /* Selection */
        ::selection {
            background-color: rgba(24, 119, 242, 0.3);
            color: var(--text-primary);
        }

        /* Focus Styles */
        *:focus {
            outline: none;
        }

        .focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(var(--card-bg-rgb), 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--border-color);
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: var(--bg-color);
            color: var(--text-secondary);
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tag:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .tag.primary {
            background: var(--primary);
            color: white;
        }

        .tag.primary:hover {
            background: var(--primary-dark);
        }

        .tag.success {
            background: var(--success);
            color: white;
        }

        .tag.warning {
            background: var(--warning);
            color: white;
        }

        .tag.danger {
            background: var(--accent);
            color: white;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: var(--accent);
            color: white;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
        }

        .badge.success {
            background: var(--success);
        }

        .badge.warning {
            background: var(--warning);
        }

        .badge.info {
            background: var(--primary);
        }

        /* Tooltips */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--card-bg);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
            margin-bottom: 8px;
        }

        [data-tooltip]:after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--text-primary);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
            margin-bottom: 2px;
        }

        [data-tooltip]:hover:before,
        [data-tooltip]:hover:after {
            opacity: 1;
            visibility: visible;
        }

        /* Switches */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: var(--transition);
            border-radius: 34px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .switch-slider {
            background-color: var(--primary);
        }

        input:checked + .switch-slider:before {
            transform: translateX(24px);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }

        /* Accordion */
        .accordion {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .accordion-item {
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            padding: 16px 20px;
            background: var(--bg-color);
            border: none;
            width: 100%;
            text-align: right;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .accordion-header:hover {
            background: var(--border-color);
        }

        .accordion-content {
            padding: 20px;
            background: var(--card-bg);
            display: none;
        }

        .accordion-item.active .accordion-content {
            display: block;
        }

        .accordion-item.active .accordion-header {
            background: var(--primary);
            color: white;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .card-content {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(69, 189, 98, 0.1);
            color: var(--success);
        }

        .stat-change.negative {
            background: rgba(240, 40, 73, 0.1);
            color: var(--accent);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-right: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-dot {
            position: absolute;
            right: -29px;
            top: 0;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            border: 4px solid var(--card-bg);
        }

        .timeline-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
        }

        .timeline-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .timeline-text {
            font-size: 14px;
            line-height: 1.5;
        }

        /* Avatar Group */
        .avatar-group {
            display: flex;
            align-items: center;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--card-bg);
            margin-right: -10px;
        }

        .avatar:last-child {
            margin-right: 0;
        }

        .avatar-more {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-color);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            border: 2px solid var(--card-bg);
            margin-right: 0;
        }

        /* Rating */
        .rating {
            display: flex;
            gap: 2px;
            color: var(--warning);
        }

        .rating-star {
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-star:hover {
            transform: scale(1.2);
        }

        /* Progress Circle */
        .progress-circle {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .progress-circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-circle-bg {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 8;
        }

        .progress-circle-fill {
            fill: none;
            stroke: var(--primary);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 226;
            stroke-dashoffset: calc(226 - (226 * var(--progress)) / 100);
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-circle-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Dropzone */
        .dropzone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-color);
        }

        .dropzone:hover {
            border-color: var(--primary);
            background: rgba(24, 119, 242, 0.05);
        }

        .dropzone.active {
            border-color: var(--primary);
            background: rgba(24, 119, 242, 0.1);
        }

        .dropzone-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .dropzone-text {
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .dropzone-hint {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: var(--text-primary);
            transform: scale(1.1);
        }

        /* Date Picker */
        .date-picker {
            position: relative;
        }

        .date-picker input {
            padding-left: 40px;
        }

        .date-picker-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        /* Time Picker */
        .time-picker {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .time-input {
            flex: 1;
        }

        .time-separator {
            color: var(--text-secondary);
            font-weight: 700;
        }

        /* Emoji Picker */
        .emoji-picker {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-elevated);
            padding: 12px;
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            width: 280px;
            z-index: 1000;
        }

        .emoji-picker.show {
            display: grid;
            animation: fadeInUp 0.3s ease;
        }

        .emoji-option {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .emoji-option:hover {
            background: var(--bg-color);
            transform: scale(1.2);
        }

        /* Audio Player */
        .audio-player {
            background: var(--bg-color);
            border-radius: var(--radius);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .audio-play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .audio-play-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .audio-progress {
            flex: 1;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .audio-progress-fill {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: var(--primary);
            width: var(--progress, 0%);
        }

        .audio-time {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 40px;
        }

        /* Video Player */
        .video-player {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            background: #000;
        }

        .video-player video {
            width: 100%;
            display: block;
        }

        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-player:hover .video-controls {
            opacity: 1;
        }

        .video-progress {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .video-progress-fill {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: var(--primary);
            width: var(--progress, 0%);
        }

        .video-play-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .video-play-btn:hover {
            transform: scale(1.1);
        }

        .video-volume {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .video-volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .video-volume-fill {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: white;
            width: var(--volume, 100%);
        }

        /* Image Gallery */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .gallery-item {
            position: relative;
            border-radius: var(--radius-sm);
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 1;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }

        .gallery-count {
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .lightbox.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        .lightbox-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            left: 0;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
        }

        .lightbox-close:hover {
            transform: scale(1.1);
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .lightbox-nav:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-prev {
            right: 20px;
        }

        .lightbox-next {
            left: 20px;
        }

        .lightbox-caption {
            position: absolute;
            bottom: -40px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-size: 14px;
        }

        /* Calendar */
        .calendar {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-size: 18px;
            font-weight: 700;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-color);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .calendar-nav-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            padding: 8px;
            font-weight: 600;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 600;
        }

        .calendar-day:hover {
            background: var(--bg-color);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
        }

        .calendar-day.selected {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(24, 119, 242, 0.3);
        }

        .calendar-day.other-month {
            color: var(--text-light);
        }

        .calendar-day.event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--accent);
            border-radius: 50%;
        }

        /* Kanban Board */
        .kanban-board {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
        }

        .kanban-column {
            min-width: 280px;
            background: var(--bg-color);
            border-radius: var(--radius);
            padding: 16px;
        }

        .kanban-column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .kanban-column-title {
            font-weight: 700;
            font-size: 16px;
        }

        .kanban-column-count {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .kanban-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 200px;
        }

        .kanban-card {
            background: var(--card-bg);
            border-radius: var(--radius-sm);
            padding: 16px;
            box-shadow: var(--shadow);
            cursor: move;
            transition: var(--transition);
        }

        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .kanban-card-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .kanban-card-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .kanban-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .kanban-card-assignee {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Gantt Chart */
        .gantt-chart {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .gantt-header {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 12px;
            margin-bottom: 20px;
            min-width: 800px;
        }

        .gantt-task-header {
            width: 200px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .gantt-timeline-header {
            flex: 1;
            display: flex;
        }

        .gantt-month {
            flex: 1;
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            padding: 0 10px;
        }

        .gantt-body {
            min-width: 800px;
        }

        .gantt-task {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .gantt-task-name {
            width: 200px;
            font-weight: 600;
            padding-right: 20px;
        }

        .gantt-timeline {
            flex: 1;
            height: 32px;
            background: var(--bg-color);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .gantt-progress {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: var(--primary);
            border-radius: 16px;
            width: var(--progress, 0%);
            transition: width 0.3s ease;
        }

        /* Organization Chart */
        .org-chart {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .org-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .org-node::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--border-color);
            transform: translateX(-50%);
        }

        .org-node:last-child::after {
            display: none;
        }

        .org-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            margin-bottom: 8px;
        }

        .org-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .org-title {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .org-children {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 40px;
            position: relative;
        }

        .org-children::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--border-color);
            transform: translateX(-50%);
        }

        .org-child {
            position: relative;
        }

        .org-child::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--border-color);
            transform: translateX(-50%);
        }

        .org-child::after {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: calc(100% + 40px);
            height: 2px;
            background: var(--border-color);
            transform: translateX(-50%);
        }

        /* Mind Map */
        .mind-map {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            overflow: auto;
            min-height: 400px;
        }

        .mind-node {
            padding: 12px 20px;
            background: var(--bg-color);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            min-width: 150px;
            cursor: pointer;
            transition: var(--transition);
        }

        .mind-node:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-hover);
        }

        .mind-node.active {
            background: var(--primary);
            color: white;
        }

        .mind-node-title {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .mind-node-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .mind-node.active .mind-node-description {
            color: rgba(255,255,255,0.8);
        }

        /* File Manager */
        .file-manager {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .file-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }

        .file-path {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .file-path a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .file-path a:hover {
            text-decoration: underline;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
        }

        .file-item {
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            padding: 12px;
            border-radius: var(--radius-sm);
        }

        .file-item:hover {
            background: var(--bg-color);
            transform: translateY(-2px);
        }

        .file-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: var(--primary);
            background: var(--bg-color);
            border-radius: var(--radius);
        }

        .file-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            word-break: break-word;
        }

        .file-size {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Code Editor */
        .code-editor {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .editor-header {
            background: var(--bg-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .editor-title {
            font-family: monospace;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .editor-actions {
            display: flex;
            gap: 8px;
        }

        .editor-content {
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            min-height: 200px;
            background: var(--bg-color);
            color: var(--text-primary);
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* Terminal */
        .terminal {
            background: #1e1e1e;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }

        .terminal-header {
            background: #2d2d2d;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .terminal-button.close {
            background: #ff5f56;
        }

        .terminal-button.minimize {
            background: #ffbd2e;
        }

        .terminal-button.maximize {
            background: #27ca3f;
        }

        .terminal-title {
            color: #fff;
            font-size: 12px;
            margin-right: auto;
        }

        .terminal-body {
            padding: 20px;
            color: #fff;
            font-size: 14px;
            line-height: 1.5;
            min-height: 200px;
        }

        .terminal-prompt {
            color: #27ca3f;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #fff;
            font-family: inherit;
            font-size: inherit;
            width: 100%;
            outline: none;
        }

        /* Music Player */
        .music-player {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .music-cover {
            width: 200px;
            height: 200px;
            border-radius: var(--radius);
            object-fit: cover;
            margin: 0 auto 20px;
            display: block;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .music-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .music-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .music-artist {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .music-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .music-control-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition);
        }

        .music-control-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .music-control-btn.secondary {
            background: var(--bg-color);
            color: var(--text-primary);
        }

        .music-progress {
            margin-bottom: 20px;
        }

        .music-time {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .music-volume {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .music-volume-icon {
            color: var(--text-secondary);
            font-size: 18px;
        }

        /* Weather Widget */
        .weather-widget {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius);
            padding: 24px;
            color: white;
            box-shadow: var(--shadow);
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .weather-location {
            font-size: 18px;
            font-weight: 700;
        }

        .weather-date {
            font-size: 14px;
            opacity: 0.9;
        }

        .weather-temp {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .weather-condition {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .weather-detail {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .weather-detail i {
            font-size: 20px;
            opacity: 0.9;
        }

        .weather-detail span {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Crypto Widget */
        .crypto-widget {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .crypto-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .crypto-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .crypto-name {
            flex: 1;
        }

        .crypto-symbol {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .crypto-fullname {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .crypto-price {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .crypto-change {
            font-size: 14px;
            font-weight: 600;
        }

        .crypto-change.positive {
            color: var(--success);
        }

        .crypto-change.negative {
            color: var(--accent);
        }

        .crypto-chart {
            height: 60px;
            margin-top: 20px;
            position: relative;
        }

        /* Stock Widget */
        .stock-widget {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stock-symbol {
            font-weight: 700;
            font-size: 18px;
        }

        .stock-price {
            font-size: 24px;
            font-weight: 700;
        }

        .stock-change {
            font-size: 14px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
            display: inline-block;
        }

        .stock-change.positive {
            background: rgba(69, 189, 98, 0.1);
            color: var(--success);
        }

        .stock-change.negative {
            background: rgba(240, 40, 73, 0.1);
            color: var(--accent);
        }

        .stock-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stock-info-item {
            display: flex;
            justify-content: space-between;
        }

        .stock-info-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* E-commerce */
        .product-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .product-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .product-description {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .product-price-current {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .product-price-old {
            font-size: 14px;
            color: var(--text-secondary);
            text-decoration: line-through;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 16px;
        }

        .product-rating-stars {
            color: var(--warning);
        }

        .product-rating-count {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .product-actions {
            display: flex;
            gap: 8px;
        }

        /* News Feed */
        .news-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .news-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .news-category {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .news-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .news-excerpt {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .news-source {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .news-source-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            object-fit: cover;
        }

        /* Job Listing */
        .job-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .job-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .job-company {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .job-company-logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: cover;
        }

        .job-company-info h3 {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .job-company-info p {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .job-type {
            background: var(--bg-color);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .job-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .job-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .job-details {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .job-detail {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .job-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        /* Real Estate */
        .property-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .property-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .property-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .property-content {
            padding: 20px;
        }

        .property-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .property-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .property-type {
            background: var(--bg-color);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .property-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .property-location {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .property-features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            text-align: center;
            padding: 16px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 16px;
        }

        .property-feature {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .property-feature i {
            color: var(--primary);
            font-size: 18px;
            margin-bottom: 4px;
        }

        .property-feature span {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .property-feature strong {
            font-size: 16px;
            color: var(--text-primary);
        }

        /* Restaurant Menu */
        .menu-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .menu-item-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .menu-item-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .menu-item-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .menu-item-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .menu-item-tag {
            background: var(--bg-color);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .menu-item-tag.vegetarian {
            background: rgba(69, 189, 98, 0.1);
            color: var(--success);
        }

        .menu-item-tag.spicy {
            background: rgba(240, 40, 73, 0.1);
            color: var(--accent);
        }

        .menu-item-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        /* Fitness Tracker */
        .fitness-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .fitness-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .fitness-title {
            font-weight: 700;
            font-size: 18px;
        }

        .fitness-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .fitness-stat {
            text-align: center;
            padding: 16px;
            background: var(--bg-color);
            border-radius: var(--radius);
        }

        .fitness-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .fitness-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fitness-goal {
            margin-bottom: 20px;
        }

        .fitness-goal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .fitness-goal-title {
            font-size: 14px;
            font-weight: 600;
        }

        .fitness-goal-progress {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .fitness-activities {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .fitness-activity {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-color);
            border-radius: var(--radius);
        }

        .fitness-activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .fitness-activity-info {
            flex: 1;
        }

        .fitness-activity-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .fitness-activity-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Language Learning */
        .language-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .language-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .language-flag {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border-color);
        }

        .language-info h3 {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .language-info p {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .language-progress {
            margin-bottom: 20px;
        }

        .language-level {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .language-level-title {
            font-size: 14px;
            font-weight: 600;
        }

        .language-level-value {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .language-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .language-stat {
            text-align: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: var(--radius);
        }

        .language-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .language-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .language-lessons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .language-lesson {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .language-lesson:hover {
            background: var(--border-color);
        }

        .language-lesson.completed {
            background: rgba(69, 189, 98, 0.1);
        }

        .language-lesson.completed .language-lesson-title {
            color: var(--success);
        }

        .language-lesson-title {
            font-weight: 600;
            font-size: 14px;
        }

        .language-lesson-duration {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* AI Assistant */
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
        }

        .ai-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            box-shadow: var(--shadow-elevated);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: var(--transition);
        }

        .ai-button:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 8px 32px rgba(24, 119, 242, 0.4);
        }

        .ai-chat {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 320px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-elevated);
            overflow: hidden;
            display: none;
        }

        .ai-chat.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .ai-chat-header {
            padding: 16px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-chat-title {
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-chat-body {
            max-height: 400px;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ai-message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .ai-message.user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message.assistant {
            align-self: flex-start;
            background: var(--bg-color);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .ai-chat-input {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
        }

        .ai-input {
            flex: 1;
            padding: 10px 16px;
            border-radius: 20px;
            border: 2px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-primary);
            font-size: 14px;
        }

        .ai-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .ai-send {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .ai-send:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        /* AR/VR */
        .ar-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .ar-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 20px;
        }

        .ar-placeholder i {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .ar-placeholder h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .ar-placeholder p {
            font-size: 14px;
            opacity: 0.9;
            max-width: 80%;
        }

        .ar-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Blockchain */
        .blockchain-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .blockchain-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .blockchain-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f7931a, #ff9800);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .blockchain-info h3 {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .blockchain-info p {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .blockchain-address {
            background: var(--bg-color);
            padding: 12px 16px;
            border-radius: var(--radius);
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .blockchain-copy {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }

        .blockchain-copy:hover {
            transform: scale(1.1);
        }

        .blockchain-transactions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .blockchain-transaction {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: var(--radius);
        }

        .blockchain-transaction-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .blockchain-transaction-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .blockchain-transaction-details h4 {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .blockchain-transaction-details p {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .blockchain-transaction-amount {
            font-weight: 700;
            font-size: 14px;
        }

        .blockchain-transaction-amount.positive {
            color: var(--success);
        }

        .blockchain-transaction-amount.negative {
            color: var(--accent);
        }

        /* IoT Dashboard */
        .iot-dashboard {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .iot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .iot-title {
            font-weight: 700;
            font-size: 18px;
        }

        .iot-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--success);
            font-weight: 600;
        }

        .iot-status.offline {
            color: var(--accent);
        }

        .iot-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .iot-status.offline .iot-status-dot {
            background: var(--accent);
        }

        .iot-devices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .iot-device {
            background: var(--bg-color);
            border-radius: var(--radius);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .iot-device:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .iot-device-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .iot-device-info {
            flex: 1;
        }

        .iot-device-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .iot-device-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .iot-device-status.online {
            color: var(--success);
        }

        .iot-device-status.offline {
            color: var(--accent);
        }

        .iot-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .iot-control {
            background: var(--bg-color);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .iot-control:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .iot-control-icon {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .iot-control-name {
            font-weight: 600;
            font-size: 13px;
        }

        /* Quantum Computing */
        .quantum-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .quantum-placeholder {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            position: relative;
        }

        .quantum-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--primary), var(--secondary), var(--accent), var(--primary));
            animation: rotate 4s linear infinite;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .quantum-inner {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
            font-weight: 700;
        }

        .quantum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .quantum-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            max-width: 80%;
            margin: 0 auto 20px;
        }

        /* Space Exploration */
        .space-card {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            border-radius: var(--radius);
            padding: 20px;
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .space-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="30" r="1" fill="white" opacity="0.8"/><circle cx="60" cy="20" r="1" fill="white" opacity="0.6"/><circle cx="80" cy="50" r="1" fill="white" opacity="0.9"/><circle cx="40" cy="70" r="1" fill="white" opacity="0.7"/><circle cx="70" cy="80" r="1" fill="white" opacity="0.5"/></svg>');
            opacity: 0.3;
        }

        .space-header {
            position: relative;
            z-index: 1;
            text-align: center;
            margin-bottom: 20px;
        }

        .space-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .space-subtitle {
            font-size: 14px;
            opacity: 0.8;
        }

        .space-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .space-stat {
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius);
            backdrop-filter: blur(10px);
        }

        .space-stat-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .space-stat-label {
            font-size: 11px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Footer */
        .footer {
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 40px 0 20px;
            margin-top: 40px;
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-section h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            font-size: 14px;
        }

        .footer-links a:hover {
            color: var(--primary);
            padding-right: 8px;
        }

        .footer-social {
            display: flex;
            gap: 16px;
            margin-top: 20px;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-color);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: var(--transition);
        }

        .social-icon:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-4px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .text-primary {
            color: var(--primary) !important;
        }

        .text-success {
            color: var(--success) !important;
        }

        .text-warning {
            color: var(--warning) !important;
        }

        .text-danger {
            color: var(--accent) !important;
        }

        .text-secondary {
            color: var(--text-secondary) !important;
        }

        .bg-primary {
            background: var(--primary) !important;
            color: white !important;
        }

        .bg-success {
            background: var(--success) !important;
            color: white !important;
        }

        .bg-warning {
            background: var(--warning) !important;
            color: white !important;
        }

        .bg-danger {
            background: var(--accent) !important;
            color: white !important;
        }

        .bg-secondary {
            background: var(--bg-color) !important;
        }

        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-5 { margin-bottom: 20px; }
        .mb-6 { margin-bottom: 24px; }
        .mb-8 { margin-bottom: 32px; }

        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 12px; }
        .mt-4 { margin-top: 16px; }
        .mt-5 { margin-top: 20px; }
        .mt-6 { margin-top: 24px; }
        .mt-8 { margin-top: 32px; }

        .p-1 { padding: 4px; }
        .p-2 { padding: 8px; }
        .p-3 { padding: 12px; }
        .p-4 { padding: 16px; }
        .p-5 { padding: 20px; }
        .p-6 { padding: 24px; }

        .rounded { border-radius: var(--radius); }
        .rounded-sm { border-radius: var(--radius-sm); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-full { border-radius: 50%; }

        .shadow { box-shadow: var(--shadow); }
        .shadow-hover { box-shadow: var(--shadow-hover); }
        .shadow-elevated { box-shadow: var(--shadow-elevated); }

        .cursor-pointer { cursor: pointer; }
        .cursor-default { cursor: default; }
        .cursor-not-allowed { cursor: not-allowed; }

        .transition { transition: var(--transition); }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease;
        }

        .animate-slide-up {
            animation: slideUp 0.5s ease;
        }

        .animate-slide-down {
            animation: slideDown 0.5s ease;
        }

        .opacity-0 { opacity: 0; }
        .opacity-25 { opacity: 0.25; }
        .opacity-50 { opacity: 0.5; }
        .opacity-75 { opacity: 0.75; }
        .opacity-100 { opacity: 1; }

        .pointer-events-none { pointer-events: none; }
        .pointer-events-auto { pointer-events: auto; }

        .select-none { user-select: none; }
        .select-text { user-select: text; }

        .overflow-hidden { overflow: hidden; }
        .overflow-auto { overflow: auto; }
        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .line-clamp-1 {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-w-0 { min-width: 0; }
        .min-h-0 { min-height: 0; }

        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .flex-col { flex-direction: column; }
        .flex-row { flex-direction: row; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-nowrap { flex-wrap: nowrap; }
        .flex-1 { flex: 1 1 0%; }
        .flex-auto { flex: 1 1 auto; }
        .flex-none { flex: none; }
        .flex-grow { flex-grow: 1; }
        .flex-shrink { flex-shrink: 1; }
        .flex-shrink-0 { flex-shrink: 0; }

        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .items-center { align-items: center; }
        .items-baseline { align-items: baseline; }
        .items-stretch { align-items: stretch; }

        .justify-start { justify-content: flex-start; }
        .justify-end { justify-content: flex-end; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        .justify-evenly { justify-content: space-evenly; }

        .gap-1 { gap: 4px; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .gap-5 { gap: 20px; }
        .gap-6 { gap: 24px; }

        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-cols-5 { grid-template-columns: repeat(5, 1fr); }
        .grid-cols-6 { grid-template-columns: repeat(6, 1fr); }

        .col-span-1 { grid-column: span 1; }
        .col-span-2 { grid-column: span 2; }
        .col-span-3 { grid-column: span 3; }
        .col-span-4 { grid-column: span 4; }
        .col-span-5 { grid-column: span 5; }
        .col-span-6 { grid-column: span 6; }

        .row-span-1 { grid-row: span 1; }
        .row-span-2 { grid-row: span 2; }
        .row-span-3 { grid-row: span 3; }
        .row-span-4 { grid-row: span 4; }

        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }

        .top-0 { top: 0; }
        .right-0 { right: 0; }
        .bottom-0 { bottom: 0; }
        .left-0 { left: 0; }

        .z-0 { z-index: 0; }
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }

        /* Print Styles */
        @media print {
            .header,
            .sidebar,
            .right-sidebar,
            .chat-widget,
            .ai-assistant,
            .footer {
                display: none !important;
            }

            .main-container {
                margin: 0;
                padding: 0;
                max-width: none;
            }

            .feed {
                width: 100%;
                max-width: none;
            }

            .post-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
                margin-bottom: 20px;
            }

            body {
                background: white;
                color: black;
            }

            a {
                color: black;
                text-decoration: underline;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --primary: #0044cc;
                --primary-dark: #003399;
                --secondary: #006600;
                --secondary-dark: #004d00;
                --accent: #cc0000;
                --text-primary: #000000;
                --text-secondary: #333333;
                --border-color: #000000;
            }

            .card,
            .widget,
            .post-card,
            .create-post-card {
                border: 2px solid var(--border-color);
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Dark Mode Preference */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #2d88ff;
                --primary-dark: #1a7cff;
                --secondary: #31a24c;
                --secondary-dark: #2a8c40;
                --accent: #f02849;
                --bg-color: #18191a;
                --card-bg: #242526;
                --sidebar-bg: #242526;
                --text-primary: #e4e6eb;
                --text-secondary: #b0b3b8;
                --border-color: #3e4042;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-users"></i>
        </div>
        <div class="spinner"></div>
        <div class="loading-text">جاري تحميل التطبيق...</div>
    </div>

    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-users"></i>
            </div>
            <h1 class="login-title">شبكتي المتطورة</h1>
            <p class="login-subtitle">منصة التواصل الاجتماعي المتكاملة مع 120 ميزة</p>
            
            <div class="social-login">
                <button class="social-btn google" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i>
                    <span>تسجيل الدخول بحساب Google</span>
                </button>
                <button class="social-btn facebook" onclick="loginWithFacebook()">
                    <i class="fab fa-facebook"></i>
                    <span>تسجيل الدخول بحساب Facebook</span>
                </button>
                <button class="social-btn twitter" onclick="loginWithTwitter()">
                    <i class="fab fa-twitter"></i>
                    <span>تسجيل الدخول بحساب X</span>
                </button>
            </div>
            
            <div class="login-divider">
                <span>أو</span>
            </div>
            
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="أدخل بريدك الإلكتروني" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="أدخل كلمة المرور" required>
                </div>
                
                <div class="login-options">
                    <label class="form-checkbox">
                        <input type="checkbox" id="rememberMe">
                        <span>تذكرني</span>
                    </label>
                    <a href="#" class="forgot-password" onclick="showForgotPassword()">نسيت كلمة المرور؟</a>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i>
                    تسجيل الدخول
                </button>
                
                <div class="register-link">
                    ليس لديك حساب؟ <a href="#" onclick="showRegister()">إنشاء حساب جديد</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <div class="logo-container">
                    <a href="#" class="logo">
                        <i class="fas fa-users logo-icon"></i>
                        <span class="logo-text">شبكتي</span>
                    </a>
                    
                    <!-- Theme Toggle -->
                    <label class="theme-toggle">
                        <input type="checkbox" id="themeToggle">
                        <span class="theme-slider">
                            <i class="fas fa-sun"></i>
                            <i class="fas fa-moon"></i>
                        </span>
                    </label>
                </div>
                
                <!-- Search Bar -->
                <div class="search-bar">
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="ابحث عن أصدقاء أو منشورات أو مجموعات...">
                        <i class="fas fa-search search-icon"></i>
                        <div class="search-results" id="searchResults"></div>
                    </div>
                </div>
                
                <!-- Header Controls -->
                <div class="header-controls">
                    <button class="icon-btn" onclick="showNotifications()" data-tooltip="الإشعارات">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </button>
                    
                    <button class="icon-btn" onclick="showMessages()" data-tooltip="الرسائل">
                        <i class="fas fa-comment-dots"></i>
                        <span class="notification-badge" id="messageCount">0</span>
                    </button>
                    
                    <button class="icon-btn" onclick="showFriendRequests()" data-tooltip="طلبات الصداقة">
                        <i class="fas fa-user-plus"></i>
                        <span class="notification-badge" id="friendRequestCount">0</span>
                    </button>
                    
                    <button class="icon-btn" onclick="showCreateMenu()" data-tooltip="إنشاء جديد">
                        <i class="fas fa-plus"></i>
                    </button>
                    
                    <!-- User Menu -->
                    <div class="user-menu">
                        <img src="" alt="صورة الملف الشخصي" class="user-avatar" id="headerAvatar" onclick="toggleDropdown('userDropdown')">
                        <div class="dropdown-menu" id="userDropdown">
                            <div class="dropdown-header">
                                <img src="" alt="صورة الملف الشخصي" class="user-avatar" id="dropdownAvatar">
                                <div class="dropdown-header-info">
                                    <h3 id="dropdownName">اسم المستخدم</h3>
                                    <p id="dropdownEmail">البريد الإلكتروني</p>
                                </div>
                            </div>
                            
                            <a href="#" class="dropdown-item" onclick="showProfile()">
                                <i class="fas fa-user"></i>
                                <span>الملف الشخصي</span>
                            </a>
                            <a href="#" class="dropdown-item" onclick="showSettings()">
                                <i class="fas fa-cog"></i>
                                <span>الإعدادات</span>
                            </a>
                            <a href="#" class="dropdown-item" onclick="showFriends()">
                                <i class="fas fa-users"></i>
                                <span>الأصدقاء</span>
                                <span class="badge" id="friendsBadge">0</span>
                            </a>
                            <a href="#" class="dropdown-item" onclick="showGroups()">
                                <i class="fas fa-user-group"></i>
                                <span>المجموعات</span>
                                <span class="badge" id="groupsBadge">0</span>
                            </a>
                            <a href="#" class="dropdown-item" onclick="showEvents()">
                                <i class="fas fa-calendar-alt"></i>
                                <span>الأحداث</span>
                                <span class="badge" id="eventsBadge">0</span>
                            </a>
                            
                            <div class="dropdown-divider"></div>
                            
                            <a href="#" class="dropdown-item" onclick="showHelp()">
                                <i class="fas fa-question-circle"></i>
                                <span>المساعدة والدعم</span>
                            </a>
                            <a href="#" class="dropdown-item" onclick="showFeedback()">
                                <i class="fas fa-comment-alt"></i>
                                <span>إرسال ملاحظات</span>
                            </a>
                            
                            <div class="dropdown-divider"></div>
                            
                            <button class="dropdown-item" onclick="logout()" style="color: var(--accent);">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>تسجيل الخروج</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Create Menu Dropdown -->
        <div class="dropdown-menu" id="createMenu" style="top: 70px; right: 20px;">
            <button class="dropdown-item" onclick="createPost()">
                <i class="fas fa-edit" style="color: #1877f2;"></i>
                <span>منشور جديد</span>
            </button>
            <button class="dropdown-item" onclick="createStory()">
                <i class="fas fa-circle" style="color: #45bd62;"></i>
                <span>قصة جديدة</span>
            </button>
            <button class="dropdown-item" onclick="createEvent()">
                <i class="fas fa-calendar-plus" style="color: #f7b928;"></i>
                <span>حدث جديد</span>
            </button>
            <button class="dropdown-item" onclick="createGroup()">
                <i class="fas fa-users" style="color: #e41e3f;"></i>
                <span>مجموعة جديدة</span>
            </button>
            <button class="dropdown-item" onclick="createPage()">
                <i class="fas fa-flag" style="color: #8a8d91;"></i>
                <span>صفحة جديدة</span>
            </button>
            <button class="dropdown-item" onclick="createPoll()">
                <i class="fas fa-chart-bar" style="color: #ff6b6b;"></i>
                <span>استطلاع جديد</span>
            </button>
        </div>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="profile-cover"></div>
                    <div class="profile-content">
                        <div class="profile-header">
                            <img src="" alt="صورة الملف الشخصي" class="profile-avatar" id="profileAvatar" onclick="showProfile()">
                            <h2 class="profile-name" id="profileName">اسم المستخدم</h2>
                            <p class="profile-bio" id="profileBio">وصف شخصي قصير...</p>
                        </div>
                        
                        <div class="profile-stats">
                            <div class="stat-item" onclick="showFriends()">
                                <span class="stat-number" id="profileFriendsCount">0</span>
                                <span class="stat-label">أصدقاء</span>
                            </div>
                            <div class="stat-item" onclick="showPosts()">
                                <span class="stat-number" id="profilePostsCount">0</span>
                                <span class="stat-label">منشورات</span>
                            </div>
                            <div class="stat-item" onclick="showPhotos()">
                                <span class="stat-number" id="profilePhotosCount">0</span>
                                <span class="stat-label">صور</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="editProfile()">
                            <i class="fas fa-edit"></i> 
                            تعديل الملف الشخصي
                        </button>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="sidebar-nav">
                    <div class="nav-title">
                        <i class="fas fa-compass"></i>
                        <span>استكشف</span>
                    </div>
                    
                    <a href="#" class="nav-item active" onclick="showFeed()" data-page="feed">
                        <i class="fas fa-home"></i>
                        <span>الصفحة الرئيسية</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showFriends()" data-page="friends">
                        <i class="fas fa-user-friends"></i>
                        <span>الأصدقاء</span>
                        <span class="nav-badge" id="navFriendsBadge">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showGroups()" data-page="groups">
                        <i class="fas fa-user-group"></i>
                        <span>المجموعات</span>
                        <span class="nav-badge" id="navGroupsBadge">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showMarketplace()" data-page="marketplace">
                        <i class="fas fa-store"></i>
                        <span>Marketplace</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showWatch()" data-page="watch">
                        <i class="fas fa-video"></i>
                        <span>Watch</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showEvents()" data-page="events">
                        <i class="fas fa-calendar-alt"></i>
                        <span>الأحداث</span>
                        <span class="nav-badge" id="navEventsBadge">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showMemories()" data-page="memories">
                        <i class="fas fa-history"></i>
                        <span>الذكريات</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSaved()" data-page="saved">
                        <i class="fas fa-bookmark"></i>
                        <span>المحفوظات</span>
                    </a>
                    
                    <div class="nav-title" style="margin-top: 24px;">
                        <i class="fas fa-cog"></i>
                        <span>الإعدادات</span>
                    </div>
                    
                    <a href="#" class="nav-item" onclick="showSettings()" data-page="settings">
                        <i class="fas fa-sliders-h"></i>
                        <span>الإعدادات العامة</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showPrivacy()" data-page="privacy">
                        <i class="fas fa-lock"></i>
                        <span>الخصوصية</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showLanguage()" data-page="language">
                        <i class="fas fa-language"></i>
                        <span>اللغة</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showAccessibility()" data-page="accessibility">
                        <i class="fas fa-universal-access"></i>
                        <span>إمكانية الوصول</span>
                    </a>
                </nav>
                
                <!-- Shortcuts -->
                <div class="shortcuts">
                    <div class="nav-title">
                        <i class="fas fa-link"></i>
                        <span>اختصاراتك</span>
                    </div>
                    
                    <a href="#" class="shortcut-item" onclick="openShortcut('developers')">
                        <div class="shortcut-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <span>مجتمع المطورين</span>
                    </a>
                    <a href="#" class="shortcut-item" onclick="openShortcut('gaming')">
                        <div class="shortcut-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <span>الألعاب</span>
                    </a>
                    <a href="#" class="shortcut-item" onclick="openShortcut('music')">
                        <div class="shortcut-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <span>الموسيقى</span>
                    </a>
                    <a href="#" class="shortcut-item" onclick="openShortcut('sports')">
                        <div class="shortcut-icon">
                            <i class="fas fa-futbol"></i>
                        </div>
                        <span>الرياضة</span>
                    </a>
                    <a href="#" class="shortcut-item" onclick="openShortcut('education')">
                        <div class="shortcut-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <span>التعليم</span>
                    </a>
                </div>
            </aside>

            <!-- Main Feed -->
            <main class="feed" id="mainContent">
                <!-- Stories Section -->
                <div class="stories-section">
                    <div class="stories-header">
                        <h3 class="stories-title">القصص</h3>
                        <a href="#" class="watch-all" onclick="watchAllStories()">مشاهدة الكل</a>
                    </div>
                    <div class="stories-container" id="storiesContainer">
                        <!-- Stories will be loaded here -->
                        <div class="story create-story" onclick="createStory()">
                            <div class="add-story">
                                <i class="fas fa-plus"></i>
                            </div>
                            <p class="create-story-text">إنشاء قصة</p>
                        </div>
                    </div>
                </div>

                <!-- Create Post -->
                <div class="create-post-card">
                    <div class="create-post-header">
                        <img src="" alt="صورة المستخدم" class="create-post-avatar" id="createPostAvatar">
                        <div class="post-input-container">
                            <textarea class="post-input" id="postInput" placeholder="ماذا يخطر ببالك؟"></textarea>
                            <div class="post-preview" id="postPreview">
                                <!-- Post preview will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="post-actions">
                        <button class="post-action-btn photo" onclick="addPhotoToPost()">
                            <i class="fas fa-image"></i>
                            <span>صورة/فيديو</span>
                        </button>
                        <button class="post-action-btn feeling" onclick="addFeelingToPost()">
                            <i class="fas fa-smile"></i>
                            <span>شعور/نشاط</span>
                        </button>
                        <button class="post-action-btn tag" onclick="tagFriendsInPost()">
                            <i class="fas fa-tag"></i>
                            <span>إشارة</span>
                        </button>
                        <button class="post-action-btn poll" onclick="createPoll()">
                            <i class="fas fa-chart-bar"></i>
                            <span>استطلاع</span>
                        </button>
                        <button class="post-action-btn live" onclick="goLive()">
                            <i class="fas fa-video"></i>
                            <span>بث مباشر</span>
                        </button>
                    </div>
                    
                    <div class="post-privacy" onclick="changePostPrivacy()" id="postPrivacy">
                        <i class="fas fa-globe"></i>
                        <span>عام</span>
                        <i class="fas fa-chevron-down" style="margin-right: auto;"></i>
                    </div>
                    
                    <button class="post-submit" id="postSubmit" onclick="createNewPost()" disabled>
                        <i class="fas fa-paper-plane"></i>
                        <span>نشر</span>
                    </button>
                </div>

                <!-- Posts Container -->
                <div class="posts-container" id="postsContainer">
                    <!-- Posts will be loaded here -->
                    <div class="empty-state" id="emptyPosts">
                        <i class="fas fa-newspaper"></i>
                        <h3>لا توجد منشورات</h3>
                        <p>كن أول من ينشر على هذه المنصة!</p>
                        <button class="btn btn-primary" onclick="createPost()">
                            <i class="fas fa-plus"></i>
                            إنشاء منشور
                        </button>
                    </div>
                </div>
                
                <!-- Loading -->
                <div class="loading hidden" id="postsLoading">
                    <div class="spinner"></div>
                    <p>جاري تحميل المنشورات...</p>
                </div>
                
                <!-- Load More -->
                <div class="text-center mt-6" id="loadMoreContainer">
                    <button class="btn btn-secondary" id="loadMoreBtn" onclick="loadMorePosts()">
                        <i class="fas fa-sync-alt"></i>
                        تحميل المزيد
                    </button>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Birthdays -->
                <div class="widget">
                    <h3 class="widget-title">
                        <i class="fas fa-birthday-cake"></i>
                        <span>مناسبات اليوم</span>
                    </h3>
                    <div id="birthdaysList">
                        <!-- Birthdays will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-birthday-cake"></i>
                            <p>لا توجد مناسبات اليوم</p>
                        </div>
                    </div>
                </div>

                <!-- Contacts -->
                <div class="widget">
                    <h3 class="widget-title">
                        <i class="fas fa-user-friends"></i>
                        <span>الأصدقاء المتصلين</span>
                        <a href="#" class="widget-action" onclick="showAllContacts()">كل الجهات</a>
                    </h3>
                    <div id="contactsList">
                        <!-- Contacts will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-user-friends"></i>
                            <p>لا يوجد أصدقاء متصلين</p>
                        </div>
                    </div>
                </div>

                <!-- Groups -->
                <div class="widget">
                    <h3 class="widget-title">
                        <i class="fas fa-user-group"></i>
                        <span>مجموعات مقترحة</span>
                        <a href="#" class="widget-action" onclick="showAllGroups()">كل المجموعات</a>
                    </h3>
                    <div id="groupsList">
                        <!-- Groups will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-user-group"></i>
                            <p>لا توجد مجموعات مقترحة</p>
                        </div>
                    </div>
                </div>

                <!-- Events -->
                <div class="widget">
                    <h3 class="widget-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>الأحداث القادمة</span>
                        <a href="#" class="widget-action" onclick="showAllEvents()">كل الأحداث</a>
                    </h3>
                    <div id="eventsList">
                        <!-- Events will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <p>لا توجد أحداث قادمة</p>
                        </div>
                    </div>
                </div>

                <!-- Sponsored -->
                <div class="widget">
                    <h3 class="widget-title">
                        <i class="fas fa-ad"></i>
                        <span>إعلانات ممولة</span>
                    </h3>
                    <div id="sponsoredList">
                        <!-- Sponsored content will be loaded here -->
                        <div class="sponsored-item" onclick="openSponsored()">
                            <img src="https://via.placeholder.com/300x150?text=Advertisement" alt="إعلان" class="sponsored-image">
                            <div class="sponsored-info">
                                <h4>تعلم البرمجة مجاناً</h4>
                                <p>انضم إلى أكبر منصة تعليمية للبرمجة في الوطن العربي</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trending -->
                <div class="widget">
                    <h3 class="widget-title">
                        <i class="fas fa-fire"></i>
                        <span>المواضيع الرائجة</span>
                    </h3>
                    <div class="trending-list" id="trendingList">
                        <!-- Trending topics will be loaded here -->
                        <div class="trending-item" onclick="openTrending('programming')">
                            <div class="trending-category">تكنولوجيا</div>
                            <div class="trending-title">أفضل لغات البرمجة 2024</div>
                            <div class="trending-count">١٢٤٥ تغريدة</div>
                        </div>
                        <div class="trending-item" onclick="openTrending('football')">
                            <div class="trending-category">رياضة</div>
                            <div class="trending-title">كأس العالم 2026</div>
                            <div class="trending-count">٩٨٧ تغريدة</div>
                        </div>
                        <div class="trending-item" onclick="openTrending('movies')">
                            <div class="trending-category">ترفيه</div>
                            <div class="trending-title">أفضل الأفلام 2024</div>
                            <div class="trending-count">٧٦٥ تغريدة</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Chat Widget -->
        <div class="chat-widget" id="chatWidget">
            <div class="chat-header">
                <h3 class="chat-title">الدردشة</h3>
                <button class="chat-close" onclick="hideChat()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-list" id="chatList">
                <!-- Chat list will be loaded here -->
                <div class="empty-state">
                    <i class="fas fa-comments"></i>
                    <p>لا توجد محادثات</p>
                </div>
            </div>
        </div>

        <!-- AI Assistant -->
        <div class="ai-assistant">
            <div class="ai-chat" id="aiChat">
                <div class="ai-chat-header">
                    <h3 class="ai-chat-title">
                        <i class="fas fa-robot"></i>
                        مساعد الذكاء الاصطناعي
                    </h3>
                    <button class="chat-close" onclick="hideAIChat()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="ai-chat-body" id="aiChatBody">
                    <div class="ai-message assistant">
                        مرحباً! أنا مساعدك الذكي. كيف يمكنني مساعدتك اليوم؟
                    </div>
                </div>
                <div class="ai-chat-input">
                    <input type="text" class="ai-input" id="aiInput" placeholder="اكتب رسالتك هنا...">
                    <button class="ai-send" onclick="sendAIMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            <button class="ai-button" onclick="toggleAIChat()">
                <i class="fas fa-robot"></i>
            </button>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>شبكتي المتطورة</h3>
                        <p>منصة التواصل الاجتماعي العربية المتكاملة مع 120 ميزة متقدمة.</p>
                        <div class="footer-social">
                            <a href="#" class="social-icon">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a href="#" class="social-icon">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div class="footer-section">
                        <h3>روابط سريعة</h3>
                        <ul class="footer-links">
                            <li><a href="#" onclick="showAbout()">عن المنصة</a></li>
                            <li><a href="#" onclick="showCareers()">الوظائف</a></li>
                            <li><a href="#" onclick="showPrivacy()">سياسة الخصوصية</a></li>
                            <li><a href="#" onclick="showTerms()">الشروط والأحكام</a></li>
                            <li><a href="#" onclick="showCookies()">ملفات تعريف الارتباط</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h3>المساعدة</h3>
                        <ul class="footer-links">
                            <li><a href="#" onclick="showHelp()">مركز المساعدة</a></li>
                            <li><a href="#" onclick="showFAQ()">الأسئلة الشائعة</a></li>
                            <li><a href="#" onclick="showSupport()">الدعم الفني</a></li>
                            <li><a href="#" onclick="showReport()">الإبلاغ عن مشكلة</a></li>
                            <li><a href="#" onclick="showContact()">اتصل بنا</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h3>التطبيقات</h3>
                        <ul class="footer-links">
                            <li><a href="#" onclick="downloadApp('ios')">
                                <i class="fab fa-apple"></i> App Store
                            </a></li>
                            <li><a href="#" onclick="downloadApp('android')">
                                <i class="fab fa-google-play"></i> Google Play
                            </a></li>
                            <li><a href="#" onclick="downloadApp('windows')">
                                <i class="fab fa-windows"></i> Microsoft Store
                            </a></li>
                            <li><a href="#" onclick="showWebApp()">التطبيق الويب</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p>© 2024 شبكتي المتطورة. جميع الحقوق محفوظة.</p>
                    <p>الإصدار 4.0.0 | تم التطوير بأحدث تقنيات الويب</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals will be added here dynamically -->

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signInWithPopup, 
            GoogleAuthProvider, 
            FacebookAuthProvider, 
            TwitterAuthProvider,
            signOut,
            onAuthStateChanged,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDoc, 
            getDocs, 
            updateDoc, 
            deleteDoc, 
            query, 
            where, 
            orderBy, 
            limit,
            serverTimestamp,
            arrayUnion,
            arrayRemove,
            increment,
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL,
            deleteObject
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAq5BqeYKtWgQNbidsMn_ICThMJ09dawV4",
            authDomain: "pomk-ad283.firebaseapp.com",
            projectId: "pomk-ad283",
            storageBucket: "pomk-ad283.firebasestorage.app",
            messagingSenderId: "793266753212",
            appId: "1:793266753212:web:eaadb78066e885cb278ab9",
            measurementId: "G-NVB3RP77RJ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        // Providers
        const googleProvider = new GoogleAuthProvider();
        const facebookProvider = new FacebookAuthProvider();
        const twitterProvider = new TwitterAuthProvider();

        // Make Firebase available globally
        window.firebase = { app, auth, db, storage, googleProvider, facebookProvider, twitterProvider };
        window.firebaseMethods = {
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signInWithPopup,
            signOut,
            sendPasswordResetEmail,
            collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, query, where, orderBy, limit,
            serverTimestamp, arrayUnion, arrayRemove, increment, onSnapshot,
            ref, uploadBytes, getDownloadURL, deleteObject
        };
    </script>

    <!-- Main JavaScript -->
    <script>
        // Global Variables
        let currentUser = null;
        let userData = null;
        let posts = [];
        let notifications = [];
        let messages = [];
        let friends = [];
        let groups = [];
        let events = [];
        let stories = [];
        let currentPage = 'feed';
        let isLoading = false;
        let lastPostDoc = null;
        let hasMorePosts = true;

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Check if Firebase is loaded
            const checkFirebase = setInterval(() => {
                if (window.firebase && window.firebase.auth) {
                    clearInterval(checkFirebase);
                    initApp();
                }
            }, 100);
        });

        // Initialize App
        function initApp() {
            // Check auth state
            window.firebase.auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                    showApp();
                    loadInitialData();
                } else {
                    showLogin();
                }
            });

            // Initialize components
            initTheme();
            initEventListeners();
            initModals();
        }

        // Show Login Page
        function showLogin() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        // Show App
        function showApp() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // Update user info in header
            updateUserInfo();
        }

        // Load User Data
        async function loadUserData() {
            try {
                const userDoc = await window.firebaseMethods.getDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'users', currentUser.uid)
                );
                
                if (userDoc.exists()) {
                    userData = userDoc.data();
                    updateUserInfo();
                } else {
                    // Create user document if doesn't exist
                    await createUserDocument();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                showToast('حدث خطأ في تحميل بيانات المستخدم', 'error');
            }
        }

        // Create User Document
        async function createUserDocument() {
            try {
                const userData = {
                    uid: currentUser.uid,
                    displayName: currentUser.displayName || currentUser.email.split('@')[0],
                    email: currentUser.email,
                    photoURL: currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.displayName || currentUser.email)}&background=1877f2&color=fff&size=150`,
                    bio: 'مرحباً! أنا جديد على شبكتي.',
                    friends: [],
                    friendRequests: [],
                    notifications: [],
                    posts: 0,
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    createdAt: window.firebaseMethods.serverTimestamp(),
                    lastSeen: window.firebaseMethods.serverTimestamp(),
                    settings: {
                        theme: 'light',
                        language: 'ar',
                        privacy: {
                            profile: 'public',
                            posts: 'friends',
                            friendsList: 'friends'
                        },
                        notifications: {
                            likes: true,
                            comments: true,
                            shares: true,
                            friendRequests: true,
                            messages: true
                        }
                    }
                };

                await window.firebaseMethods.setDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'users', currentUser.uid),
                    userData
                );

                window.userData = userData;
                updateUserInfo();
            } catch (error) {
                console.error('Error creating user document:', error);
                showToast('حدث خطأ في إنشاء حساب المستخدم', 'error');
            }
        }

        // Update User Info in UI
        function updateUserInfo() {
            const data = userData || {
                displayName: currentUser?.displayName || 'مستخدم',
                photoURL: currentUser?.photoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=150',
                email: currentUser?.email || '',
                bio: 'وصف شخصي قصير...'
            };

            // Update header
            document.getElementById('headerAvatar').src = data.photoURL;
            document.getElementById('dropdownAvatar').src = data.photoURL;
            document.getElementById('dropdownName').textContent = data.displayName;
            document.getElementById('dropdownEmail').textContent = data.email;

            // Update profile card
            document.getElementById('profileAvatar').src = data.photoURL;
            document.getElementById('profileName').textContent = data.displayName;
            document.getElementById('profileBio').textContent = data.bio || 'وصف شخصي قصير...';
            document.getElementById('createPostAvatar').src = data.photoURL;

            // Update stats
            document.getElementById('profileFriendsCount').textContent = data.friends?.length || 0;
            document.getElementById('profilePostsCount').textContent = data.posts || 0;
            document.getElementById('profilePhotosCount').textContent = '0';
        }

        // Load Initial Data
        function loadInitialData() {
            loadPosts();
            loadNotifications();
            loadMessages();
            loadFriends();
            loadGroups();
            loadEvents();
            loadStories();
            loadBirthdays();
            loadContacts();
            loadTrending();
        }

        // Load Posts
        async function loadPosts() {
            if (isLoading) return;
            
            isLoading = true;
            showLoading('postsLoading');
            hideEmptyState('emptyPosts');

            try {
                const postsQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'posts'),
                    window.firebaseMethods.orderBy('createdAt', 'desc'),
                    window.firebaseMethods.limit(10)
                );

                const snapshot = await window.firebaseMethods.getDocs(postsQuery);
                posts = [];
                const postsContainer = document.getElementById('postsContainer');
                postsContainer.innerHTML = '';

                if (snapshot.empty) {
                    showEmptyState('emptyPosts');
                } else {
                    snapshot.forEach((doc) => {
                        const post = { id: doc.id, ...doc.data() };
                        posts.push(post);
                        renderPost(post);
                    });
                    
                    lastPostDoc = snapshot.docs[snapshot.docs.length - 1];
                    hasMorePosts = snapshot.docs.length === 10;
                }
            } catch (error) {
                console.error('Error loading posts:', error);
                showToast('حدث خطأ في تحميل المنشورات', 'error');
            } finally {
                isLoading = false;
                hideLoading('postsLoading');
                updateLoadMoreButton();
            }
        }

        // Load More Posts
        async function loadMorePosts() {
            if (isLoading || !hasMorePosts) return;
            
            isLoading = true;
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            loadMoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحميل...';
            loadMoreBtn.disabled = true;

            try {
                const postsQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'posts'),
                    window.firebaseMethods.orderBy('createdAt', 'desc'),
                    window.firebaseMethods.startAfter(lastPostDoc),
                    window.firebaseMethods.limit(10)
                );

                const snapshot = await window.firebaseMethods.getDocs(postsQuery);

                if (!snapshot.empty) {
                    snapshot.forEach((doc) => {
                        const post = { id: doc.id, ...doc.data() };
                        posts.push(post);
                        renderPost(post);
                    });
                    
                    lastPostDoc = snapshot.docs[snapshot.docs.length - 1];
                    hasMorePosts = snapshot.docs.length === 10;
                } else {
                    hasMorePosts = false;
                }
            } catch (error) {
                console.error('Error loading more posts:', error);
                showToast('حدث خطأ في تحميل المزيد من المنشورات', 'error');
            } finally {
                isLoading = false;
                loadMoreBtn.innerHTML = '<i class="fas fa-sync-alt"></i> تحميل المزيد';
                loadMoreBtn.disabled = false;
                updateLoadMoreButton();
            }
        }

        // Update Load More Button
        function updateLoadMoreButton() {
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            if (!hasMorePosts) {
                loadMoreContainer.style.display = 'none';
            } else {
                loadMoreContainer.style.display = 'block';
            }
        }

        // Render Post
        function renderPost(post) {
            const postsContainer = document.getElementById('postsContainer');
            
            const postElement = document.createElement('div');
            postElement.className = 'post-card';
            postElement.id = `post-${post.id}`;
            
            // Format time
            const timeAgo = formatTimeAgo(post.createdAt?.toDate());
            
            // Create post HTML
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-user">
                        <img src="${post.userPhotoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=48'}" 
                             alt="${post.userName}" 
                             class="post-avatar"
                             onclick="viewProfile('${post.userId}')">
                        <div class="post-user-info">
                            <h3 onclick="viewProfile('${post.userId}')">${post.userName}</h3>
                            <div class="post-meta">
                                <span class="post-time">${timeAgo}</span>
                                <span class="post-privacy-icon">
                                    <i class="fas fa-${getPrivacyIcon(post.privacy)}"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="post-options">
                        <button class="post-options-btn" onclick="togglePostOptions('${post.id}')">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                        <div class="post-options-menu" id="post-options-${post.id}">
                            <button class="dropdown-item" onclick="savePost('${post.id}')">
                                <i class="fas fa-bookmark"></i>
                                <span>حفظ المنشور</span>
                            </button>
                            <button class="dropdown-item" onclick="copyPostLink('${post.id}')">
                                <i class="fas fa-link"></i>
                                <span>نسخ الرابط</span>
                            </button>
                            ${post.userId === currentUser?.uid ? `
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item" onclick="editPost('${post.id}')">
                                    <i class="fas fa-edit"></i>
                                    <span>تعديل</span>
                                </button>
                                <button class="dropdown-item" onclick="deletePost('${post.id}')" style="color: var(--accent);">
                                    <i class="fas fa-trash"></i>
                                    <span>حذف</span>
                                </button>
                            ` : `
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item" onclick="reportPost('${post.id}')">
                                    <i class="fas fa-flag"></i>
                                    <span>الإبلاغ</span>
                                </button>
                                <button class="dropdown-item" onclick="blockUser('${post.userId}')">
                                    <i class="fas fa-ban"></i>
                                    <span>حظر المستخدم</span>
                                </button>
                            `}
                        </div>
                    </div>
                </div>
                
                <div class="post-content">${formatPostContent(post.content)}</div>
                
                ${post.mediaUrl ? `
                    <div class="post-media">
                        <img src="${post.mediaUrl}" alt="صورة المنشور" onclick="viewMedia('${post.mediaUrl}')">
                    </div>
                ` : ''}
                
                <div class="post-stats">
                    <div class="post-stat" onclick="showLikes('${post.id}')">
                        <i class="fas fa-thumbs-up"></i>
                        <span>${post.likes || 0}</span>
                    </div>
                    <div class="post-stat" onclick="showComments('${post.id}')">
                        <i class="fas fa-comment"></i>
                        <span>${post.comments || 0}</span>
                    </div>
                    <div class="post-stat" onclick="showShares('${post.id}')">
                        <i class="fas fa-share"></i>
                        <span>${post.shares || 0}</span>
                    </div>
                </div>
                
                <div class="post-actions-buttons">
                    <button class="post-action-btn-large ${post.liked ? 'active' : ''}" 
                            onclick="toggleLike('${post.id}')" id="like-btn-${post.id}">
                        <i class="fas fa-thumbs-up"></i>
                        <span>${post.liked ? 'معجب' : 'أعجبني'}</span>
                    </button>
                    <button class="post-action-btn-large" onclick="focusComment('${post.id}')">
                        <i class="fas fa-comment"></i>
                        <span>تعليق</span>
                    </button>
                    <button class="post-action-btn-large" onclick="sharePost('${post.id}')">
                        <i class="fas fa-share"></i>
                        <span>مشاركة</span>
                    </button>
                </div>
                
                <div class="comments-section" id="comments-${post.id}">
                    <div class="comment-form">
                        <img src="${userData?.photoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=36'}" 
                             alt="صورة المستخدم" 
                             class="comment-avatar">
                        <div class="comment-input-container">
                            <input type="text" 
                                   class="comment-input" 
                                   id="comment-input-${post.id}" 
                                   placeholder="اكتب تعليقاً..."
                                   onkeypress="if(event.key === 'Enter') addComment('${post.id}')">
                            <button class="comment-submit" onclick="addComment('${post.id}')">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <div class="comments-list" id="comments-list-${post.id}">
                        <!-- Comments will be loaded here -->
                    </div>
                    ${post.comments > 2 ? `
                        <div class="load-more-comments" onclick="loadComments('${post.id}')">
                            عرض المزيد من التعليقات
                        </div>
                    ` : ''}
                </div>
            `;
            
            postsContainer.appendChild(postElement);
            
            // Load initial comments
            loadComments(post.id, 2);
        }

        // Format Post Content
        function formatPostContent(content) {
            if (!content) return '';
            
            // Convert URLs to links
            content = content.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
            
            // Convert hashtags
            content = content.replace(/#(\w+)/g, '<a href="#" onclick="searchHashtag(\'$1\')" class="hashtag">#$1</a>');
            
            // Convert mentions
            content = content.replace(/@(\w+)/g, '<a href="#" onclick="viewProfileByUsername(\'$1\')" class="mention">@$1</a>');
            
            return content;
        }

        // Get Privacy Icon
        function getPrivacyIcon(privacy) {
            switch(privacy) {
                case 'public': return 'globe';
                case 'friends': return 'user-friends';
                case 'only_me': return 'lock';
                default: return 'globe';
            }
        }

        // Format Time Ago
        function formatTimeAgo(date) {
            if (!date) return 'منذ لحظات';
            
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `منذ ${days} يوم`;
            if (hours > 0) return `منذ ${hours} ساعة`;
            if (minutes > 0) return `منذ ${minutes} دقيقة`;
            return 'الآن';
        }

        // Create New Post
        async function createNewPost() {
            const content = document.getElementById('postInput').value.trim();
            if (!content) {
                showToast('الرجاء كتابة محتوى للمنشور', 'warning');
                return;
            }

            const postSubmit = document.getElementById('postSubmit');
            postSubmit.disabled = true;
            postSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري النشر...';

            try {
                const postData = {
                    userId: currentUser.uid,
                    userName: userData?.displayName || currentUser.displayName,
                    userPhotoURL: userData?.photoURL || currentUser.photoURL,
                    content: content,
                    privacy: getCurrentPrivacy(),
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    liked: false,
                    createdAt: window.firebaseMethods.serverTimestamp(),
                    updatedAt: window.firebaseMethods.serverTimestamp()
                };

                // Handle media upload if exists
                const mediaFile = document.getElementById('postMediaInput')?.files[0];
                if (mediaFile) {
                    // Upload media to storage
                    const storageRef = window.firebaseMethods.ref(window.firebase.storage, `posts/${currentUser.uid}/${Date.now()}_${mediaFile.name}`);
                    await window.firebaseMethods.uploadBytes(storageRef, mediaFile);
                    const downloadURL = await window.firebaseMethods.getDownloadURL(storageRef);
                    postData.mediaUrl = downloadURL;
                    postData.mediaType = mediaFile.type.startsWith('image/') ? 'image' : 'video';
                }

                // Add post to Firestore
                const postRef = await window.firebaseMethods.addDoc(
                    window.firebaseMethods.collection(window.firebase.db, 'posts'),
                    postData
                );

                // Update user's post count
                await window.firebaseMethods.updateDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'users', currentUser.uid),
                    {
                        posts: window.firebaseMethods.increment(1),
                        updatedAt: window.firebaseMethods.serverTimestamp()
                    }
                );

                // Clear form
                document.getElementById('postInput').value = '';
                document.getElementById('postPreview').innerHTML = '';
                document.getElementById('postPreview').classList.remove('show');
                if (document.getElementById('postMediaInput')) {
                    document.getElementById('postMediaInput').value = '';
                }

                // Update UI
                postData.id = postRef.id;
                postData.createdAt = { toDate: () => new Date() };
                posts.unshift(postData);
                
                const postsContainer = document.getElementById('postsContainer');
                const emptyState = document.getElementById('emptyPosts');
                if (emptyState) emptyState.remove();
                
                postsContainer.insertBefore(createPostElement(postData), postsContainer.firstChild);

                showToast('تم نشر المنشور بنجاح', 'success');
            } catch (error) {
                console.error('Error creating post:', error);
                showToast('حدث خطأ أثناء نشر المنشور', 'error');
            } finally {
                postSubmit.disabled = false;
                postSubmit.innerHTML = '<i class="fas fa-paper-plane"></i> نشر';
            }
        }

        // Get Current Privacy
        function getCurrentPrivacy() {
            const privacyElement = document.getElementById('postPrivacy');
            const text = privacyElement.querySelector('span').textContent;
            
            switch(text) {
                case 'عام': return 'public';
                case 'الأصدقاء فقط': return 'friends';
                case 'أنا فقط': return 'only_me';
                default: return 'public';
            }
        }

        // Add Photo to Post
        function addPhotoToPost() {
            const input = document.createElement('input');
            input.type = 'file';
            input.id = 'postMediaInput';
            input.accept = 'image/*,video/*';
            input.style.display = 'none';
            input.onchange = handleMediaUpload;
            
            document.body.appendChild(input);
            input.click();
        }

        // Handle Media Upload
        function handleMediaUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('postPreview');
                preview.innerHTML = '';
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'post-preview-image';
                    preview.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.className = 'post-preview-image';
                    preview.appendChild(video);
                }
                
                // Add remove button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-preview';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.onclick = function() {
                    preview.innerHTML = '';
                    preview.classList.remove('show');
                    event.target.value = '';
                };
                preview.appendChild(removeBtn);
                
                preview.classList.add('show');
            };
            reader.readAsDataURL(file);
        }

        // Toggle Like
        async function toggleLike(postId) {
            if (!currentUser) {
                showToast('الرجاء تسجيل الدخول أولاً', 'warning');
                return;
            }

            try {
                const postRef = window.firebaseMethods.doc(window.firebase.db, 'posts', postId);
                const likeRef = window.firebaseMethods.doc(
                    window.firebaseMethods.collection(window.firebase.db, 'posts', postId, 'likes'),
                    currentUser.uid
                );

                const likeDoc = await window.firebaseMethods.getDoc(likeRef);
                
                if (likeDoc.exists()) {
                    // Remove like
                    await window.firebaseMethods.deleteDoc(likeRef);
                    await window.firebaseMethods.updateDoc(postRef, {
                        likes: window.firebaseMethods.increment(-1),
                        liked: false
                    });
                    
                    // Update UI
                    const likeBtn = document.getElementById(`like-btn-${postId}`);
                    likeBtn.classList.remove('active');
                    likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i><span>أعجبني</span>';
                    
                    const likesCount = document.querySelector(`#post-${postId} .post-stat:nth-child(1) span`);
                    const currentLikes = parseInt(likesCount.textContent) || 0;
                    likesCount.textContent = currentLikes - 1;
                } else {
                    // Add like
                    await window.firebaseMethods.setDoc(likeRef, {
                        userId: currentUser.uid,
                        userName: userData?.displayName,
                        userPhotoURL: userData?.photoURL,
                        createdAt: window.firebaseMethods.serverTimestamp()
                    });
                    
                    await window.firebaseMethods.updateDoc(postRef, {
                        likes: window.firebaseMethods.increment(1),
                        liked: true
                    });
                    
                    // Update UI
                    const likeBtn = document.getElementById(`like-btn-${postId}`);
                    likeBtn.classList.add('active');
                    likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i><span>معجب</span>';
                    
                    const likesCount = document.querySelector(`#post-${postId} .post-stat:nth-child(1) span`);
                    const currentLikes = parseInt(likesCount.textContent) || 0;
                    likesCount.textContent = currentLikes + 1;
                    
                    // Send notification
                    await sendLikeNotification(postId);
                }
            } catch (error) {
                console.error('Error toggling like:', error);
                showToast('حدث خطأ في تحديث الإعجاب', 'error');
            }
        }

        // Send Like Notification
        async function sendLikeNotification(postId) {
            try {
                const postDoc = await window.firebaseMethods.getDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'posts', postId)
                );
                
                if (postDoc.exists()) {
                    const post = postDoc.data();
                    if (post.userId !== currentUser.uid) {
                        await window.firebaseMethods.addDoc(
                            window.firebaseMethods.collection(window.firebase.db, 'notifications'),
                            {
                                type: 'like',
                                fromUserId: currentUser.uid,
                                fromUserName: userData?.displayName,
                                fromUserPhotoURL: userData?.photoURL,
                                toUserId: post.userId,
                                postId: postId,
                                message: `${userData?.displayName} أعجب بمنشورك`,
                                read: false,
                                createdAt: window.firebaseMethods.serverTimestamp()
                            }
                        );
                    }
                }
            } catch (error) {
                console.error('Error sending like notification:', error);
            }
        }

        // Add Comment
        async function addComment(postId) {
            const input = document.getElementById(`comment-input-${postId}`);
            const content = input.value.trim();
            
            if (!content || !currentUser) {
                showToast('الرجاء كتابة تعليق', 'warning');
                return;
            }

            try {
                const commentData = {
                    userId: currentUser.uid,
                    userName: userData?.displayName,
                    userPhotoURL: userData?.photoURL,
                    postId: postId,
                    content: content,
                    likes: 0,
                    createdAt: window.firebaseMethods.serverTimestamp()
                };

                // Add comment
                await window.firebaseMethods.addDoc(
                    window.firebaseMethods.collection(window.firebase.db, 'comments'),
                    commentData
                );

                // Update post comment count
                await window.firebaseMethods.updateDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'posts', postId),
                    {
                        comments: window.firebaseMethods.increment(1)
                    }
                );

                // Update user comment count
                await window.firebaseMethods.updateDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'users', currentUser.uid),
                    {
                        comments: window.firebaseMethods.increment(1)
                    }
                );

                // Clear input
                input.value = '';
                
                // Update UI
                const commentsCount = document.querySelector(`#post-${postId} .post-stat:nth-child(2) span`);
                const currentComments = parseInt(commentsCount.textContent) || 0;
                commentsCount.textContent = currentComments + 1;
                
                // Add comment to list
                addCommentToUI(postId, {
                    ...commentData,
                    id: 'temp-' + Date.now(),
                    createdAt: { toDate: () => new Date() }
                });
                
                // Send notification
                await sendCommentNotification(postId);
                
                showToast('تم إضافة التعليق', 'success');
            } catch (error) {
                console.error('Error adding comment:', error);
                showToast('حدث خطأ في إضافة التعليق', 'error');
            }
        }

        // Add Comment to UI
        function addCommentToUI(postId, comment) {
            const commentsList = document.getElementById(`comments-list-${postId}`);
            if (!commentsList) return;

            const commentElement = document.createElement('div');
            commentElement.className = 'comment';
            commentElement.innerHTML = `
                <img src="${comment.userPhotoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=36'}" 
                     alt="${comment.userName}" 
                     class="comment-avatar"
                     onclick="viewProfile('${comment.userId}')">
                <div class="comment-content">
                    <div class="comment-header">
                        <span class="comment-author" onclick="viewProfile('${comment.userId}')">${comment.userName}</span>
                        <span class="comment-time">${formatTimeAgo(comment.createdAt?.toDate())}</span>
                    </div>
                    <div class="comment-text">${formatPostContent(comment.content)}</div>
                    <div class="comment-actions">
                        <span class="comment-action comment-like" onclick="toggleCommentLike('${comment.id}')">
                            <i class="fas fa-thumbs-up"></i> أعجبني
                        </span>
                        <span class="comment-action">رد</span>
                    </div>
                </div>
            `;

            commentsList.appendChild(commentElement);
        }

        // Load Comments
        async function loadComments(postId, limit = 10) {
            try {
                const commentsQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'comments'),
                    window.firebaseMethods.where('postId', '==', postId),
                    window.firebaseMethods.orderBy('createdAt', 'desc'),
                    window.firebaseMethods.limit(limit)
                );

                const snapshot = await window.firebaseMethods.getDocs(commentsQuery);
                const commentsList = document.getElementById(`comments-list-${postId}`);
                
                if (commentsList) {
                    commentsList.innerHTML = '';
                    
                    snapshot.forEach((doc) => {
                        const comment = { id: doc.id, ...doc.data() };
                        addCommentToUI(postId, comment);
                    });
                }
            } catch (error) {
                console.error('Error loading comments:', error);
            }
        }

        // Send Comment Notification
        async function sendCommentNotification(postId) {
            try {
                const postDoc = await window.firebaseMethods.getDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'posts', postId)
                );
                
                if (postDoc.exists()) {
                    const post = postDoc.data();
                    if (post.userId !== currentUser.uid) {
                        await window.firebaseMethods.addDoc(
                            window.firebaseMethods.collection(window.firebase.db, 'notifications'),
                            {
                                type: 'comment',
                                fromUserId: currentUser.uid,
                                fromUserName: userData?.displayName,
                                fromUserPhotoURL: userData?.photoURL,
                                toUserId: post.userId,
                                postId: postId,
                                message: `${userData?.displayName} علق على منشورك`,
                                read: false,
                                createdAt: window.firebaseMethods.serverTimestamp()
                            }
                        );
                    }
                }
            } catch (error) {
                console.error('Error sending comment notification:', error);
            }
        }

        // Share Post
        async function sharePost(postId) {
            if (!currentUser) {
                showToast('الرجاء تسجيل الدخول أولاً', 'warning');
                return;
            }

            try {
                // Update post share count
                await window.firebaseMethods.updateDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'posts', postId),
                    {
                        shares: window.firebaseMethods.increment(1)
                    }
                );

                // Update UI
                const sharesCount = document.querySelector(`#post-${postId} .post-stat:nth-child(3) span`);
                const currentShares = parseInt(sharesCount.textContent) || 0;
                sharesCount.textContent = currentShares + 1;

                showToast('تمت مشاركة المنشور', 'success');
            } catch (error) {
                console.error('Error sharing post:', error);
                showToast('حدث خطأ في مشاركة المنشور', 'error');
            }
        }

        // Load Notifications
        async function loadNotifications() {
            if (!currentUser) return;

            try {
                const notificationsQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'notifications'),
                    window.firebaseMethods.where('toUserId', '==', currentUser.uid),
                    window.firebaseMethods.orderBy('createdAt', 'desc'),
                    window.firebaseMethods.limit(20)
                );

                const snapshot = await window.firebaseMethods.getDocs(notificationsQuery);
                notifications = [];
                let unreadCount = 0;

                snapshot.forEach((doc) => {
                    const notification = { id: doc.id, ...doc.data() };
                    notifications.push(notification);
                    if (!notification.read) unreadCount++;
                });

                // Update notification badge
                document.getElementById('notificationCount').textContent = unreadCount;
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        // Load Messages
        async function loadMessages() {
            if (!currentUser) return;

            try {
                const messagesQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'messages'),
                    window.firebaseMethods.where('participants', 'array-contains', currentUser.uid),
                    window.firebaseMethods.orderBy('updatedAt', 'desc'),
                    window.firebaseMethods.limit(20)
                );

                const snapshot = await window.firebaseMethods.getDocs(messagesQuery);
                messages = [];
                let unreadCount = 0;

                snapshot.forEach((doc) => {
                    const message = { id: doc.id, ...doc.data() };
                    messages.push(message);
                    if (!message.read && message.senderId !== currentUser.uid) {
                        unreadCount++;
                    }
                });

                // Update message badge
                document.getElementById('messageCount').textContent = unreadCount;
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        // Load Friends
        async function loadFriends() {
            if (!currentUser || !userData) return;

            try {
                const friendsIds = userData.friends || [];
                if (friendsIds.length === 0) return;

                const friendsPromises = friendsIds.map(friendId =>
                    window.firebaseMethods.getDoc(
                        window.firebaseMethods.doc(window.firebase.db, 'users', friendId)
                    )
                );

                const friendsSnapshots = await Promise.all(friendsPromises);
                friends = [];

                friendsSnapshots.forEach((doc) => {
                    if (doc.exists()) {
                        friends.push({ id: doc.id, ...doc.data() });
                    }
                });

                // Update friends count
                const friendsCount = friends.length;
                document.getElementById('profileFriendsCount').textContent = friendsCount;
                document.getElementById('friendsBadge').textContent = friendsCount;
                document.getElementById('navFriendsBadge').textContent = friendsCount;
            } catch (error) {
                console.error('Error loading friends:', error);
            }
        }

        // Load Groups
        async function loadGroups() {
            try {
                const groupsQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'groups'),
                    window.firebaseMethods.orderBy('createdAt', 'desc'),
                    window.firebaseMethods.limit(5)
                );

                const snapshot = await window.firebaseMethods.getDocs(groupsQuery);
                groups = [];

                snapshot.forEach((doc) => {
                    groups.push({ id: doc.id, ...doc.data() });
                });

                // Update groups count
                const groupsCount = groups.length;
                document.getElementById('groupsBadge').textContent = groupsCount;
                document.getElementById('navGroupsBadge').textContent = groupsCount;
            } catch (error) {
                console.error('Error loading groups:', error);
            }
        }

        // Load Events
        async function loadEvents() {
            try {
                const now = new Date();
                const eventsQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'events'),
                    window.firebaseMethods.where('date', '>=', now),
                    window.firebaseMethods.orderBy('date', 'asc'),
                    window.firebaseMethods.limit(5)
                );

                const snapshot = await window.firebaseMethods.getDocs(eventsQuery);
                events = [];

                snapshot.forEach((doc) => {
                    events.push({ id: doc.id, ...doc.data() });
                });

                // Update events count
                const eventsCount = events.length;
                document.getElementById('eventsBadge').textContent = eventsCount;
                document.getElementById('navEventsBadge').textContent = eventsCount;
            } catch (error) {
                console.error('Error loading events:', error);
            }
        }

        // Load Stories
        async function loadStories() {
            try {
                const now = new Date();
                const twentyFourHoursAgo = new Date(now.getTime() - (24 * 60 * 60 * 1000));
                
                const storiesQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'stories'),
                    window.firebaseMethods.where('createdAt', '>=', twentyFourHoursAgo),
                    window.firebaseMethods.orderBy('createdAt', 'desc'),
                    window.firebaseMethods.limit(10)
                );

                const snapshot = await window.firebaseMethods.getDocs(storiesQuery);
                stories = [];
                const storiesContainer = document.getElementById('storiesContainer');
                
                // Clear existing stories (except create story button)
                const createStory = storiesContainer.querySelector('.create-story');
                storiesContainer.innerHTML = '';
                if (createStory) storiesContainer.appendChild(createStory);

                snapshot.forEach((doc) => {
                    const story = { id: doc.id, ...doc.data() };
                    stories.push(story);
                    renderStory(story);
                });
            } catch (error) {
                console.error('Error loading stories:', error);
            }
        }

        // Render Story
        function renderStory(story) {
            const storiesContainer = document.getElementById('storiesContainer');
            
            const storyElement = document.createElement('div');
            storyElement.className = 'story';
            storyElement.onclick = () => viewStory(story.id);
            
            storyElement.innerHTML = `
                <div class="story-content">
                    <img src="${story.mediaUrl}" alt="قصة" class="story-image">
                    <div class="story-overlay">
                        <img src="${story.userPhotoURL}" alt="${story.userName}" class="story-avatar">
                        <span class="story-username">${story.userName}</span>
                    </div>
                </div>
            `;
            
            storiesContainer.appendChild(storyElement);
        }

        // Load Birthdays
        async function loadBirthdays() {
            try {
                const today = new Date();
                const todayStr = `${today.getDate()}/${today.getMonth() + 1}`;
                
                const birthdaysQuery = window.firebaseMethods.query(
                    window.firebaseMethods.collection(window.firebase.db, 'users'),
                    window.firebaseMethods.where('birthDate', '==', todayStr),
                    window.firebaseMethods.limit(5)
                );

                const snapshot = await window.firebaseMethods.getDocs(birthdaysQuery);
                const birthdaysList = document.getElementById('birthdaysList');
                birthdaysList.innerHTML = '';

                if (snapshot.empty) {
                    birthdaysList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-birthday-cake"></i>
                            <p>لا توجد مناسبات اليوم</p>
                        </div>
                    `;
                    return;
                }

                snapshot.forEach((doc) => {
                    const user = { id: doc.id, ...doc.data() };
                    if (user.id === currentUser?.uid) return;
                    
                    const birthdayItem = document.createElement('div');
                    birthdayItem.className = 'birthday-item';
                    birthdayItem.onclick = () => viewProfile(user.id);
                    
                    birthdayItem.innerHTML = `
                        <img src="${user.photoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=48'}" 
                             alt="${user.displayName}" 
                             class="birthday-avatar">
                        <div class="birthday-info">
                            <h4>${user.displayName}</h4>
                            <p>عيد ميلاده اليوم! 🎂</p>
                        </div>
                        <button class="btn btn-primary" onclick="sendBirthdayWish('${user.id}')">
                            هنئه
                        </button>
                    `;
                    
                    birthdaysList.appendChild(birthdayItem);
                });
            } catch (error) {
                console.error('Error loading birthdays:', error);
            }
        }

        // Load Contacts
        async function loadContacts() {
            if (!currentUser || !userData) return;

            try {
                const friendsIds = userData.friends || [];
                if (friendsIds.length === 0) return;

                // Get online friends (for demo, we'll show random friends)
                const contactsList = document.getElementById('contactsList');
                contactsList.innerHTML = '';

                // Show first 5 friends as online
                const onlineFriends = friends.slice(0, 5);
                
                if (onlineFriends.length === 0) {
                    contactsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-user-friends"></i>
                            <p>لا يوجد أصدقاء متصلين</p>
                        </div>
                    `;
                    return;
                }

                onlineFriends.forEach((friend) => {
                    const contactItem = document.createElement('div');
                    contactItem.className = 'contact-item';
                    contactItem.onclick = () => viewProfile(friend.id);
                    
                    contactItem.innerHTML = `
                        <div style="position: relative;">
                            <img src="${friend.photoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=48'}" 
                                 alt="${friend.displayName}" 
                                 class="contact-avatar">
                            <div class="online-dot"></div>
                        </div>
                        <div class="contact-info">
                            <h4>${friend.displayName}</h4>
                            <p>نشط الآن</p>
                        </div>
                    `;
                    
                    contactsList.appendChild(contactItem);
                });
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }

        // Load Trending
        function loadTrending() {
            // For demo, we'll use static trending data
            const trendingList = document.getElementById('trendingList');
            
            const trendingData = [
                { category: 'تكنولوجيا', title: 'أفضل لغات البرمجة 2024', count: '١٢٤٥' },
                { category: 'رياضة', title: 'كأس العالم 2026', count: '٩٨٧' },
                { category: 'ترفيه', title: 'أفضل الأفلام 2024', count: '٧٦٥' },
                { category: 'سياسة', title: 'الانتخابات العالمية', count: '٦٥٤' },
                { category: 'اقتصاد', title: 'أسواق العملات الرقمية', count: '٥٤٣' }
            ];

            trendingList.innerHTML = '';
            trendingData.forEach((item) => {
                const trendingItem = document.createElement('div');
                trendingItem.className = 'trending-item';
                trendingItem.onclick = () => searchTrending(item.title);
                
                trendingItem.innerHTML = `
                    <div class="trending-category">${item.category}</div>
                    <div class="trending-title">${item.title}</div>
                    <div class="trending-count">${item.count} تغريدة</div>
                `;
                
                trendingList.appendChild(trendingItem);
            });
        }

        // Login with Google
        async function loginWithGoogle() {
            try {
                const result = await window.firebaseMethods.signInWithPopup(
                    window.firebase.auth, 
                    window.firebase.googleProvider
                );
                
                showToast('تم تسجيل الدخول بنجاح', 'success');
            } catch (error) {
                console.error('Error logging in with Google:', error);
                showToast('حدث خطأ في تسجيل الدخول بحساب Google', 'error');
            }
        }

        // Login with Facebook
        async function loginWithFacebook() {
            try {
                const result = await window.firebaseMethods.signInWithPopup(
                    window.firebase.auth, 
                    window.firebase.facebookProvider
                );
                
                showToast('تم تسجيل الدخول بنجاح', 'success');
            } catch (error) {
                console.error('Error logging in with Facebook:', error);
                showToast('حدث خطأ في تسجيل الدخول بحساب Facebook', 'error');
            }
        }

        // Login with Twitter
        async function loginWithTwitter() {
            try {
                const result = await window.firebaseMethods.signInWithPopup(
                    window.firebase.auth, 
                    window.firebase.twitterProvider
                );
                
                showToast('تم تسجيل الدخول بنجاح', 'success');
            } catch (error) {
                console.error('Error logging in with Twitter:', error);
                showToast('حدث خطأ في تسجيل الدخول بحساب X', 'error');
            }
        }

        // Email/Password Login
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await window.firebaseMethods.signInWithEmailAndPassword(
                    window.firebase.auth, 
                    email, 
                    password
                );
                
                showToast('تم تسجيل الدخول بنجاح', 'success');
            } catch (error) {
                console.error('Error logging in:', error);
                showToast('خطأ في البريد الإلكتروني أو كلمة المرور', 'error');
            }
        });

        // Logout
        async function logout() {
            try {
                await window.firebaseMethods.signOut(window.firebase.auth);
                showToast('تم تسجيل الخروج بنجاح', 'success');
            } catch (error) {
                console.error('Error logging out:', error);
                showToast('حدث خطأ أثناء تسجيل الخروج', 'error');
            }
        }

        // Show Forgot Password
        function showForgotPassword() {
            // Create modal for forgot password
            const modalHTML = `
                <div class="modal show" id="forgotPasswordModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">استعادة كلمة المرور</h2>
                            <button class="modal-close" onclick="closeModal('forgotPasswordModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>أدخل بريدك الإلكتروني وسنرسل لك رابطاً لاستعادة كلمة المرور.</p>
                            <div class="form-group">
                                <label class="form-label">البريد الإلكتروني</label>
                                <input type="email" id="forgotPasswordEmail" class="form-input" placeholder="أدخل بريدك الإلكتروني">
                            </div>
                            <div class="form-buttons">
                                <button class="btn btn-secondary" onclick="closeModal('forgotPasswordModal')">إلغاء</button>
                                <button class="btn btn-primary" onclick="sendPasswordReset()">إرسال الرابط</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Send Password Reset
        async function sendPasswordReset() {
            const email = document.getElementById('forgotPasswordEmail').value;
            
            if (!email) {
                showToast('الرجاء إدخال البريد الإلكتروني', 'warning');
                return;
            }
            
            try {
                await window.firebaseMethods.sendPasswordResetEmail(window.firebase.auth, email);
                closeModal('forgotPasswordModal');
                showToast('تم إرسال رابط استعادة كلمة المرور إلى بريدك الإلكتروني', 'success');
            } catch (error) {
                console.error('Error sending password reset:', error);
                showToast('حدث خطأ في إرسال رابط الاستعادة', 'error');
            }
        }

        // Show Register
        function showRegister() {
            // Create modal for registration
            const modalHTML = `
                <div class="modal show" id="registerModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">إنشاء حساب جديد</h2>
                            <button class="modal-close" onclick="closeModal('registerModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="registerForm">
                                <div class="form-group">
                                    <label class="form-label">الاسم الكامل</label>
                                    <input type="text" id="registerName" class="form-input" placeholder="أدخل اسمك الكامل" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">البريد الإلكتروني</label>
                                    <input type="email" id="registerEmail" class="form-input" placeholder="أدخل بريدك الإلكتروني" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">كلمة المرور</label>
                                    <input type="password" id="registerPassword" class="form-input" placeholder="أدخل كلمة مرور قوية" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">تأكيد كلمة المرور</label>
                                    <input type="password" id="registerConfirmPassword" class="form-input" placeholder="أعد إدخال كلمة المرور" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">تاريخ الميلاد</label>
                                    <div class="flex gap-2">
                                        <select id="birthDay" class="form-input">
                                            <option value="">اليوم</option>
                                            ${Array.from({length: 31}, (_, i) => `<option value="${i + 1}">${i + 1}</option>`).join('')}
                                        </select>
                                        <select id="birthMonth" class="form-input">
                                            <option value="">الشهر</option>
                                            ${['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر']
                                                .map((month, i) => `<option value="${i + 1}">${month}</option>`).join('')}
                                        </select>
                                        <select id="birthYear" class="form-input">
                                            <option value="">السنة</option>
                                            ${Array.from({length: 100}, (_, i) => {
                                                const year = new Date().getFullYear() - i;
                                                return `<option value="${year}">${year}</option>`;
                                            }).join('')}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الجنس</label>
                                    <div class="form-radio-group">
                                        <label class="form-radio">
                                            <input type="radio" name="gender" value="male" required>
                                            <span>ذكر</span>
                                        </label>
                                        <label class="form-radio">
                                            <input type="radio" name="gender" value="female">
                                            <span>أنثى</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-buttons">
                                    <button type="button" class="btn btn-secondary" onclick="closeModal('registerModal')">إلغاء</button>
                                    <button type="submit" class="btn btn-primary">إنشاء حساب</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add form submit handler
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                const birthDay = document.getElementById('birthDay').value;
                const birthMonth = document.getElementById('birthMonth').value;
                const birthYear = document.getElementById('birthYear').value;
                const gender = document.querySelector('input[name="gender"]:checked')?.value;
                
                if (password !== confirmPassword) {
                    showToast('كلمتا المرور غير متطابقتين', 'error');
                    return;
                }
                
                if (!birthDay || !birthMonth || !birthYear) {
                    showToast('الرجاء إدخال تاريخ الميلاد كاملاً', 'warning');
                    return;
                }
                
                if (!gender) {
                    showToast('الرجاء اختيار الجنس', 'warning');
                    return;
                }
                
                try {
                    const userCredential = await window.firebaseMethods.createUserWithEmailAndPassword(
                        window.firebase.auth, 
                        email, 
                        password
                    );
                    
                    // Update profile
                    await window.firebaseMethods.updateProfile(userCredential.user, {
                        displayName: name
                    });
                    
                    showToast('تم إنشاء الحساب بنجاح', 'success');
                    closeModal('registerModal');
                } catch (error) {
                    console.error('Error creating account:', error);
                    showToast('حدث خطأ في إنشاء الحساب', 'error');
                }
            });
        }

        // Close Modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        // Show Toast Notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            }[type];
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${type === 'success' ? 'نجاح' : type === 'error' ? 'خطأ' : type === 'warning' ? 'تحذير' : 'معلومة'}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        // Show Loading
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('hidden');
            }
        }

        // Hide Loading
        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('hidden');
            }
        }

        // Show Empty State
        function showEmptyState(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('hidden');
            }
        }

        // Hide Empty State
        function hideEmptyState(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('hidden');
            }
        }

        // Initialize Theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.checked = savedTheme === 'dark';
            }
        }

        // Toggle Theme
        function toggleTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const isDark = themeToggle.checked;
            const theme = isDark ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // Initialize Event Listeners
        function initEventListeners() {
            // Post input auto-resize
            const postInput = document.getElementById('postInput');
            if (postInput) {
                postInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                    
                    // Enable/disable submit button
                    const postSubmit = document.getElementById('postSubmit');
                    postSubmit.disabled = !this.value.trim();
                });
            }
            
            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('change', toggleTheme);
            }
            
            // Search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
            }
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dropdown-menu') && !e.target.closest('.user-menu')) {
                    hideAllDropdowns();
                }
            });
        }

        // Handle Search
        function handleSearch(e) {
            const query = e.target.value.trim();
            const searchResults = document.getElementById('searchResults');
            
            if (!query) {
                searchResults.classList.remove('show');
                return;
            }
            
            // Show loading
            searchResults.innerHTML = '<div class="search-result-item"><i class="fas fa-spinner fa-spin"></i> جاري البحث...</div>';
            searchResults.classList.add('show');
            
            // Simulate search results
            setTimeout(() => {
                const results = [
                    { type: 'user', name: 'أحمد محمد', image: 'https://ui-avatars.com/api/?name=أحمد&background=1877f2&color=fff&size=40' },
                    { type: 'post', content: 'أفضل طريقة لتعلم البرمجة...' },
                    { type: 'group', name: 'مطوري الويب العرب', members: '١٢٤٥' },
                    { type: 'hashtag', tag: 'برمجة' }
                ];
                
                searchResults.innerHTML = '';
                results.forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    
                    if (result.type === 'user') {
                        item.innerHTML = `
                            <img src="${result.image}" alt="${result.name}">
                            <span>${result.name}</span>
                        `;
                        item.onclick = () => {
                            searchInput.value = '';
                            searchResults.classList.remove('show');
                            showToast(`عرض ملف ${result.name}`, 'info');
                        };
                    } else if (result.type === 'post') {
                        item.innerHTML = `
                            <i class="fas fa-file-alt"></i>
                            <span>${result.content}</span>
                        `;
                    } else if (result.type === 'group') {
                        item.innerHTML = `
                            <i class="fas fa-users"></i>
                            <span>${result.name} (${result.members} عضو)</span>
                        `;
                    } else if (result.type === 'hashtag') {
                        item.innerHTML = `
                            <i class="fas fa-hashtag"></i>
                            <span>#${result.tag}</span>
                        `;
                    }
                    
                    searchResults.appendChild(item);
                });
            }, 500);
        }

        // Toggle Dropdown
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const isVisible = dropdown.classList.contains('show');
            
            hideAllDropdowns();
            
            if (!isVisible) {
                dropdown.classList.add('show');
            }
        }

        // Hide All Dropdowns
        function hideAllDropdowns() {
            document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        // Toggle Post Options
        function togglePostOptions(postId) {
            const optionsMenu = document.getElementById(`post-options-${postId}`);
            const isVisible = optionsMenu.classList.contains('show');
            
            // Hide all other post options menus
            document.querySelectorAll('.post-options-menu').forEach(menu => {
                if (menu.id !== `post-options-${postId}`) {
                    menu.classList.remove('show');
                }
            });
            
            if (!isVisible) {
                optionsMenu.classList.add('show');
            } else {
                optionsMenu.classList.remove('show');
            }
        }

        // Show Create Menu
        function showCreateMenu() {
            toggleDropdown('createMenu');
        }

        // View Profile
        function viewProfile(userId) {
            showToast(`عرض ملف المستخدم ${userId}`, 'info');
            // In a real app, you would navigate to the user's profile page
        }

        // View Profile by Username
        function viewProfileByUsername(username) {
            showToast(`عرض ملف @${username}`, 'info');
        }

        // Search Hashtag
        function searchHashtag(tag) {
            document.getElementById('searchInput').value = `#${tag}`;
            handleSearch({ target: document.getElementById('searchInput') });
            showToast(`البحث عن الوسم #${tag}`, 'info');
        }

        // View Media
        function viewMedia(mediaUrl) {
            // Create lightbox
            const lightboxHTML = `
                <div class="lightbox show" id="mediaLightbox">
                    <div class="lightbox-content">
                        <img src="${mediaUrl}" alt="صورة" class="lightbox-image">
                        <button class="lightbox-close" onclick="closeLightbox()">
                            <i class="fas fa-times"></i>
                        </button>
                        <button class="lightbox-nav lightbox-prev" onclick="prevMedia()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="lightbox-nav lightbox-next" onclick="nextMedia()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', lightboxHTML);
        }

        // Close Lightbox
        function closeLightbox() {
            const lightbox = document.getElementById('mediaLightbox');
            if (lightbox) {
                lightbox.remove();
            }
        }

        // Previous Media
        function prevMedia() {
            showToast('الصورة السابقة', 'info');
        }

        // Next Media
        function nextMedia() {
            showToast('الصورة التالية', 'info');
        }

        // Save Post
        function savePost(postId) {
            showToast('تم حفظ المنشور', 'success');
        }

        // Copy Post Link
        function copyPostLink(postId) {
            navigator.clipboard.writeText(`${window.location.origin}/post/${postId}`);
            showToast('تم نسخ رابط المنشور', 'success');
        }

        // Edit Post
        function editPost(postId) {
            showToast('تعديل المنشور', 'info');
        }

        // Delete Post
        async function deletePost(postId) {
            if (!confirm('هل أنت متأكد من حذف هذا المنشور؟')) return;
            
            try {
                await window.firebaseMethods.deleteDoc(
                    window.firebaseMethods.doc(window.firebase.db, 'posts', postId)
                );
                
                // Remove from UI
                const postElement = document.getElementById(`post-${postId}`);
                if (postElement) {
                    postElement.remove();
                }
                
                showToast('تم حذف المنشور', 'success');
            } catch (error) {
                console.error('Error deleting post:', error);
                showToast('حدث خطأ في حذف المنشور', 'error');
            }
        }

        // Report Post
        function reportPost(postId) {
            showToast('تم الإبلاغ عن المنشور', 'success');
        }

        // Block User
        function blockUser(userId) {
            showToast('تم حظر المستخدم', 'success');
        }

        // Show Likes
        function showLikes(postId) {
            showToast('عرض الإعجابات', 'info');
        }

        // Show Comments
        function showComments(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            if (commentInput) {
                commentInput.focus();
            }
        }

        // Show Shares
        function showShares(postId) {
            showToast('عرض المشاركات', 'info');
        }

        // Focus Comment
        function focusComment(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            if (commentInput) {
                commentInput.focus();
            }
        }

        // Toggle Comment Like
        function toggleCommentLike(commentId) {
            showToast('إعجاب بالتعليق', 'info');
        }

        // Send Birthday Wish
        function sendBirthdayWish(userId) {
            showToast('تم إرسال التهنئة', 'success');
        }

        // Search Trending
        function searchTrending(query) {
            document.getElementById('searchInput').value = query;
            handleSearch({ target: document.getElementById('searchInput') });
        }

        // Open Shortcut
        function openShortcut(shortcut) {
            showToast(`فتح ${shortcut}`, 'info');
        }

        // Open Sponsored
        function openSponsored() {
            showToast('فتح الإعلان', 'info');
        }

        // Show All Contacts
        function showAllContacts() {
            showToast('عرض كل الجهات', 'info');
        }

        // Show All Groups
        function showAllGroups() {
            showToast('عرض كل المجموعات', 'info');
        }

        // Show All Events
        function showAllEvents() {
            showToast('عرض كل الأحداث', 'info');
        }

        // Watch All Stories
        function watchAllStories() {
            showToast('مشاهدة كل القصص', 'info');
        }

        // View Story
        function viewStory(storyId) {
            showToast('مشاهدة القصة', 'info');
        }

        // Create Story
        function createStory() {
            showToast('إنشاء قصة جديدة', 'info');
        }

        // Create Event
        function createEvent() {
            showToast('إنشاء حدث جديد', 'info');
        }

        // Create Group
        function createGroup() {
            showToast('إنشاء مجموعة جديدة', 'info');
        }

        // Create Page
        function createPage() {
            showToast('إنشاء صفحة جديدة', 'info');
        }

        // Create Poll
        function createPoll() {
            showToast('إنشاء استطلاع جديد', 'info');
        }

        // Go Live
        function goLive() {
            showToast('بدء البث المباشر', 'info');
        }

        // Change Post Privacy
        function changePostPrivacy() {
            const privacyElement = document.getElementById('postPrivacy');
            const currentText = privacyElement.querySelector('span').textContent;
            const icon = privacyElement.querySelector('i');
            
            const privacyOptions = [
                { text: 'عام', icon: 'globe' },
                { text: 'الأصدقاء فقط', icon: 'user-friends' },
                { text: 'أنا فقط', icon: 'lock' }
            ];
            
            const currentIndex = privacyOptions.findIndex(option => option.text === currentText);
            const nextIndex = (currentIndex + 1) % privacyOptions.length;
            const nextOption = privacyOptions[nextIndex];
            
            privacyElement.querySelector('span').textContent = nextOption.text;
            icon.className = `fas fa-${nextOption.icon}`;
        }

        // Show Feed
        function showFeed() {
            setActivePage('feed');
            loadPosts();
        }

        // Show Friends
        function showFriends() {
            setActivePage('friends');
            showToast('عرض قائمة الأصدقاء', 'info');
        }

        // Show Groups
        function showGroups() {
            setActivePage('groups');
            showToast('عرض المجموعات', 'info');
        }

        // Show Marketplace
        function showMarketplace() {
            setActivePage('marketplace');
            showToast('عرض Marketplace', 'info');
        }

        // Show Watch
        function showWatch() {
            setActivePage('watch');
            showToast('عرض Watch', 'info');
        }

        // Show Events
        function showEvents() {
            setActivePage('events');
            showToast('عرض الأحداث', 'info');
        }

        // Show Memories
        function showMemories() {
            setActivePage('memories');
            showToast('عرض الذكريات', 'info');
        }

        // Show Saved
        function showSaved() {
            setActivePage('saved');
            showToast('عرض المحفوظات', 'info');
        }

        // Show Settings
        function showSettings() {
            setActivePage('settings');
            showToast('فتح الإعدادات', 'info');
        }

        // Show Privacy
        function showPrivacy() {
            setActivePage('privacy');
            showToast('فتح إعدادات الخصوصية', 'info');
        }

        // Show Language
        function showLanguage() {
            setActivePage('language');
            showToast('تغيير اللغة', 'info');
        }

        // Show Accessibility
        function showAccessibility() {
            setActivePage('accessibility');
            showToast('إعدادات إمكانية الوصول', 'info');
        }

        // Show Profile
        function showProfile() {
            showToast('عرض الملف الشخصي', 'info');
        }

        // Edit Profile
        function editProfile() {
            showToast('تعديل الملف الشخصي', 'info');
        }

        // Show Notifications
        function showNotifications() {
            showToast('عرض الإشعارات', 'info');
        }

        // Show Messages
        function showMessages() {
            showToast('عرض الرسائل', 'info');
        }

        // Show Friend Requests
        function showFriendRequests() {
            showToast('عرض طلبات الصداقة', 'info');
        }

        // Show Help
        function showHelp() {
            showToast('فتح مركز المساعدة', 'info');
        }

        // Show Feedback
        function showFeedback() {
            showToast('إرسال ملاحظات', 'info');
        }

        // Show About
        function showAbout() {
            showToast('عن المنصة', 'info');
        }

        // Show Careers
        function showCareers() {
            showToast('الوظائف', 'info');
        }

        // Show Terms
        function showTerms() {
            showToast('الشروط والأحكام', 'info');
        }

        // Show Cookies
        function showCookies() {
            showToast('ملفات تعريف الارتباط', 'info');
        }

        // Show Support
        function showSupport() {
            showToast('الدعم الفني', 'info');
        }

        // Show Report
        function showReport() {
            showToast('الإبلاغ عن مشكلة', 'info');
        }

        // Show Contact
        function showContact() {
            showToast('اتصل بنا', 'info');
        }

        // Download App
        function downloadApp(platform) {
            showToast(`تحميل التطبيق لـ ${platform}`, 'info');
        }

        // Show Web App
        function showWebApp() {
            showToast('التطبيق الويب', 'info');
        }

        // Set Active Page
        function setActivePage(page) {
            currentPage = page;
            
            // Update navigation items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
        }

        // Show Chat
        function showChat() {
            document.getElementById('chatWidget').classList.add('show');
        }

        // Hide Chat
        function hideChat() {
            document.getElementById('chatWidget').classList.remove('show');
        }

        // Toggle AI Chat
        function toggleAIChat() {
            const aiChat = document.getElementById('aiChat');
            aiChat.classList.toggle('show');
        }

        // Hide AI Chat
        function hideAIChat() {
            document.getElementById('aiChat').classList.remove('show');
        }

        // Send AI Message
        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addAIMessage(message, 'user');
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    'أنا مساعدك الذكي! كيف يمكنني مساعدتك اليوم؟',
                    'يمكنني مساعدتك في البحث عن المعلومات أو الإجابة على أسئلتك.',
                    'هل تريد معرفة المزيد عن ميزات المنصة؟',
                    'أنا هنا لمساعدتك في أي استفسار لديك.'
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addAIMessage(randomResponse, 'assistant');
            }, 1000);
        }

                // Add AI Message
        function addAIMessage(message, type) {
            const aiChatBody = document.getElementById('aiChatBody');
            const messageElement = document.createElement('div');
            messageElement.className = `ai-message ${type}`;
            messageElement.textContent = message;
            aiChatBody.appendChild(messageElement);
            
            // Scroll to bottom
            aiChatBody.scrollTop = aiChatBody.scrollHeight;
        }

        // Initialize Modals
        function initModals() {
            // Any modal initialization logic can go here
            console.log('Modals initialized');
        }

        // Create Post Element (for programmatic post creation)
        function createPostElement(postData) {
            const postElement = document.createElement('div');
            postElement.className = 'post-card';
            postElement.id = `post-${postData.id}`;
            
            // Similar to renderPost but for programmatic use
            // This is a simplified version for the createNewPost function
            const timeAgo = formatTimeAgo(postData.createdAt?.toDate?.() || new Date());
            
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-user">
                        <img src="${postData.userPhotoURL || userData?.photoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=48'}" 
                             alt="${postData.userName}" 
                             class="post-avatar">
                        <div class="post-user-info">
                            <h3>${postData.userName}</h3>
                            <div class="post-meta">
                                <span class="post-time">${timeAgo}</span>
                                <span class="post-privacy-icon">
                                    <i class="fas fa-${getPrivacyIcon(postData.privacy)}"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="post-content">${formatPostContent(postData.content)}</div>
                ${postData.mediaUrl ? `
                    <div class="post-media">
                        <img src="${postData.mediaUrl}" alt="صورة المنشور">
                    </div>
                ` : ''}
                <div class="post-stats">
                    <div class="post-stat">
                        <i class="fas fa-thumbs-up"></i>
                        <span>0</span>
                    </div>
                    <div class="post-stat">
                        <i class="fas fa-comment"></i>
                        <span>0</span>
                    </div>
                    <div class="post-stat">
                        <i class="fas fa-share"></i>
                        <span>0</span>
                    </div>
                </div>
                <div class="post-actions-buttons">
                    <button class="post-action-btn-large" onclick="toggleLike('${postData.id}')">
                        <i class="fas fa-thumbs-up"></i>
                        <span>أعجبني</span>
                    </button>
                    <button class="post-action-btn-large" onclick="focusComment('${postData.id}')">
                        <i class="fas fa-comment"></i>
                        <span>تعليق</span>
                    </button>
                    <button class="post-action-btn-large" onclick="sharePost('${postData.id}')">
                        <i class="fas fa-share"></i>
                        <span>مشاركة</span>
                    </button>
                </div>
            `;
            
            return postElement;
        }

        // Add Feeling to Post
        function addFeelingToPost() {
            const feelings = ['😊 سعيد', '😢 حزين', '😡 غاضب', '😴 نعسان', '🤔 متفكر', '🎉 محتفل'];
            const postInput = document.getElementById('postInput');
            
            // Create feeling selector modal
            const modalHTML = `
                <div class="modal show" id="feelingModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">اختر شعورك</h2>
                            <button class="modal-close" onclick="closeModal('feelingModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="feelings-grid">
                                ${feelings.map(feeling => `
                                    <button class="feeling-option" onclick="selectFeeling('${feeling}')">
                                        ${feeling}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Select Feeling
        function selectFeeling(feeling) {
            const postInput = document.getElementById('postInput');
            postInput.value = `${postInput.value} أشعر ${feeling} `.trim();
            closeModal('feelingModal');
            postInput.focus();
        }

        // Tag Friends in Post
        function tagFriendsInPost() {
            if (!friends.length) {
                showToast('ليس لديك أصدقاء للإشارة إليهم', 'warning');
                return;
            }
            
            const modalHTML = `
                <div class="modal show" id="tagFriendsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">أشر إلى أصدقائك</h2>
                            <button class="modal-close" onclick="closeModal('tagFriendsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="friends-list">
                                ${friends.map(friend => `
                                    <div class="friend-item" onclick="tagFriend('${friend.displayName}')">
                                        <img src="${friend.photoURL || 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=40'}" 
                                             alt="${friend.displayName}"
                                             class="friend-avatar">
                                        <span>${friend.displayName}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Add some styles
            const style = document.createElement('style');
            style.textContent = `
                .feelings-grid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 10px;
                }
                .feeling-option {
                    padding: 15px;
                    border: 2px solid var(--border-color);
                    border-radius: var(--radius);
                    background: var(--bg-color);
                    font-size: 16px;
                    cursor: pointer;
                    transition: var(--transition);
                }
                .feeling-option:hover {
                    background: var(--primary);
                    color: white;
                    transform: translateY(-2px);
                }
                .friends-list {
                    max-height: 400px;
                    overflow-y: auto;
                }
                .friend-item {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    padding: 12px;
                    border-radius: var(--radius);
                    cursor: pointer;
                    transition: var(--transition);
                }
                .friend-item:hover {
                    background: var(--bg-color);
                }
                .friend-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                }
            `;
            document.head.appendChild(style);
        }

        // Tag Friend
        function tagFriend(friendName) {
            const postInput = document.getElementById('postInput');
            postInput.value = `${postInput.value} @${friendName} `.trim();
            closeModal('tagFriendsModal');
            postInput.focus();
        }

        // Show FAQ
        function showFAQ() {
            const modalHTML = `
                <div class="modal show" id="faqModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">الأسئلة الشائعة</h2>
                            <button class="modal-close" onclick="closeModal('faqModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="accordion">
                                <div class="accordion-item">
                                    <button class="accordion-header" onclick="toggleAccordion(this)">
                                        كيف يمكنني تغيير كلمة المرور؟
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <div class="accordion-content">
                                        يمكنك تغيير كلمة المرور من الإعدادات → الحساب → تغيير كلمة المرور.
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <button class="accordion-header" onclick="toggleAccordion(this)">
                                        كيف أضيف أصدقاء؟
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <div class="accordion-content">
                                        يمكنك البحث عن أصدقاء واستخدام زر "إضافة صديق" أو قبول طلبات الصداقة المرسلة إليك.
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <button class="accordion-header" onclick="toggleAccordion(this)">
                                        كيف أنشئ مجموعة؟
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <div class="accordion-content">
                                        استخدم زر "إنشاء" في الشريط العلوي واختر "مجموعة جديدة"، ثم املأ المعلومات المطلوبة.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Toggle Accordion
        function toggleAccordion(header) {
            const item = header.parentElement;
            item.classList.toggle('active');
        }

        // Show Posts (for profile posts count)
        function showPosts() {
            showToast('عرض المنشورات', 'info');
        }

        // Show Photos
        function showPhotos() {
            showToast('عرض الصور', 'info');
        }

        // Real-time Updates (Example: listen for new posts)
        function setupRealtimeListeners() {
            if (!currentUser) return;
            
            // Listen for new posts in real-time
            const postsQuery = window.firebaseMethods.query(
                window.firebaseMethods.collection(window.firebase.db, 'posts'),
                window.firebaseMethods.orderBy('createdAt', 'desc'),
                window.firebaseMethods.limit(1)
            );
            
            window.firebaseMethods.onSnapshot(postsQuery, (snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added' && change.doc.data().userId !== currentUser.uid) {
                        const post = { id: change.doc.id, ...change.doc.data() };
                        // Check if this post is already displayed
                        if (!posts.some(p => p.id === post.id)) {
                            // Add to beginning of posts array
                            posts.unshift(post);
                            // Add to UI at the top
                            const postsContainer = document.getElementById('postsContainer');
                            const emptyState = document.getElementById('emptyPosts');
                            if (emptyState) emptyState.remove();
                            postsContainer.insertBefore(createPostElement(post), postsContainer.firstChild);
                            
                            // Show notification for new post
                            showToast(`منشور جديد من ${post.userName}`, 'info');
                        }
                    }
                });
            });
        }

        // Initialize real-time listeners when user is logged in
        if (currentUser) {
            setupRealtimeListeners();
        }

        // Utility function to check if user is online
        function updateUserOnlineStatus() {
            if (!currentUser) return;
            
            // Update last seen timestamp
            const userRef = window.firebaseMethods.doc(window.firebase.db, 'users', currentUser.uid);
            window.firebaseMethods.updateDoc(userRef, {
                lastSeen: window.firebaseMethods.serverTimestamp(),
                isOnline: true
            });
            
            // Set up offline detection
            window.addEventListener('beforeunload', () => {
                window.firebaseMethods.updateDoc(userRef, {
                    isOnline: false,
                    lastSeen: window.firebaseMethods.serverTimestamp()
                });
            });
        }

        // Call this when user logs in
        if (currentUser) {
            updateUserOnlineStatus();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter to submit post
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                const postInput = document.getElementById('postInput');
                if (postInput && document.activeElement === postInput) {
                    createNewPost();
                }
            }
            
            // Esc to close modals
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.show');
                if (modals.length > 0) {
                    modals[modals.length - 1].remove();
                }
            }
            
            // / to focus search
            if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    e.preventDefault();
                    searchInput.focus();
                }
            }
        });

        // Responsive sidebar toggle for mobile
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('mobile-show');
        }

        // Add mobile sidebar toggle button if needed
        if (window.innerWidth <= 992) {
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'sidebar-toggle';
            toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
            toggleBtn.onclick = toggleSidebar;
            document.querySelector('.header-container').prepend(toggleBtn);
            
            // Add styles for mobile sidebar
            const style = document.createElement('style');
            style.textContent = `
                .sidebar-toggle {
                    background: none;
                    border: none;
                    color: var(--text-primary);
                    font-size: 20px;
                    cursor: pointer;
                    padding: 8px;
                }
                @media (max-width: 992px) {
                    .sidebar {
                        position: fixed;
                        top: 60px;
                        right: -100%;
                        width: 80%;
                        height: calc(100vh - 60px);
                        z-index: 1000;
                        transition: var(--transition);
                        background: var(--card-bg);
                        box-shadow: var(--shadow-elevated);
                    }
                    .sidebar.mobile-show {
                        right: 0;
                    }
                    .sidebar-overlay {
                        position: fixed;
                        top: 60px;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0,0,0,0.5);
                        z-index: 999;
                        display: none;
                    }
                    .sidebar.mobile-show + .sidebar-overlay {
                        display: block;
                    }
                }
            `;
            document.head.appendChild(style);
            
            // Add overlay
            const overlay = document.createElement('div');
            overlay.className = 'sidebar-overlay';
            overlay.onclick = toggleSidebar;
            document.querySelector('.main-container').prepend(overlay);
        }

        // Infinite scroll for posts
        let isScrolling = false;
        window.addEventListener('scroll', function() {
            if (isScrolling || isLoading || !hasMorePosts) return;
            
            const scrollPosition = window.innerHeight + window.scrollY;
            const pageHeight = document.documentElement.scrollHeight;
            
            if (scrollPosition >= pageHeight - 100) {
                isScrolling = true;
                loadMorePosts();
                
                // Throttle
                setTimeout(() => {
                    isScrolling = false;
                }, 1000);
            }
        });

        // Image lazy loading
        function initLazyLoading() {
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        imageObserver.unobserve(img);
                    }
                });
            });
            
            images.forEach(img => imageObserver.observe(img));
        }

        // Initialize lazy loading
        setTimeout(initLazyLoading, 1000);

        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Add to Home Screen prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installBtn = document.createElement('button');
            installBtn.className = 'install-btn';
            installBtn.innerHTML = '<i class="fas fa-download"></i> تثبيت التطبيق';
            installBtn.onclick = installApp;
            document.querySelector('.header-controls').prepend(installBtn);
            
            // Add styles
            const style = document.createElement('style');
            style.textContent = `
                .install-btn {
                    background: var(--primary);
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: var(--transition);
                }
                .install-btn:hover {
                    background: var(--primary-dark);
                    transform: translateY(-2px);
                }
            `;
            document.head.appendChild(style);
        });

        function installApp() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    showToast('تم تثبيت التطبيق بنجاح!', 'success');
                }
                deferredPrompt = null;
            });
        }

        // Analytics tracking
        function trackEvent(eventName, eventData = {}) {
            // In a real app, you would send this to your analytics service
            console.log('Event:', eventName, eventData);
            
            // Example: Send to Firebase Analytics if available
            if (window.gtag) {
                window.gtag('event', eventName, eventData);
            }
        }

        // Track page views
        trackEvent('page_view', { page: currentPage });

        // Error boundary
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global error:', msg, error);
            trackEvent('error', { msg, url, lineNo, error: error?.message });
            return false;
        };

        // Final initialization
        console.log('Social Network Pro initialized successfully!');

        // Export functions to global scope for HTML onclick handlers
        window.addComment = addComment;
        window.addFeelingToPost = addFeelingToPost;
        window.addPhotoToPost = addPhotoToPost;
        window.blockUser = blockUser;
        window.changePostPrivacy = changePostPrivacy;
        window.closeLightbox = closeLightbox;
        window.closeModal = closeModal;
        window.copyPostLink = copyPostLink;
        window.createEvent = createEvent;
        window.createGroup = createGroup;
        window.createNewPost = createNewPost;
        window.createPage = createPage;
        window.createPoll = createPoll;
        window.createPost = createPost;
        window.createStory = createStory;
        window.deletePost = deletePost;
        window.downloadApp = downloadApp;
        window.editPost = editPost;
        window.editProfile = editProfile;
        window.focusComment = focusComment;
        window.goLive = goLive;
        window.hideAIChat = hideAIChat;
        window.hideChat = hideChat;
        window.loginWithFacebook = loginWithFacebook;
        window.loginWithGoogle = loginWithGoogle;
        window.loginWithTwitter = loginWithTwitter;
        window.logout = logout;
        window.nextMedia = nextMedia;
        window.openShortcut = openShortcut;
        window.openSponsored = openSponsored;
        window.openTrending = openTrending;
        window.prevMedia = prevMedia;
        window.reportPost = reportPost;
        window.savePost = savePost;
        window.searchHashtag = searchHashtag;
        window.searchTrending = searchTrending;
        window.selectFeeling = selectFeeling;
        window.sendAIMessage = sendAIMessage;
        window.sendBirthdayWish = sendBirthdayWish;
        window.sendPasswordReset = sendPasswordReset;
        window.sharePost = sharePost;
        window.showAbout = showAbout;
        window.showAccessibility = showAccessibility;
        window.showAllContacts = showAllContacts;
        window.showAllEvents = showAllEvents;
        window.showAllGroups = showAllGroups;
        window.showCareers = showCareers;
        window.showContact = showContact;
        window.showCookies = showCookies;
        window.showFAQ = showFAQ;
        window.showFeedback = showFeedback;
        window.showForgotPassword = showForgotPassword;
        window.showFriendRequests = showFriendRequests;
        window.showFriends = showFriends;
        window.showGroups = showGroups;
        window.showHelp = showHelp;
        window.showLanguage = showLanguage;
        window.showMarketplace = showMarketplace;
        window.showMemories = showMemories;
        window.showMessages = showMessages;
        window.showNotifications = showNotifications;
        window.showPhotos = showPhotos;
        window.showPosts = showPosts;
        window.showPrivacy = showPrivacy;
        window.showProfile = showProfile;
        window.showRegister = showRegister;
        window.showReport = showReport;
        window.showSaved = showSaved;
        window.showSettings = showSettings;
        window.showSupport = showSupport;
        window.showTerms = showTerms;
        window.showWatch = showWatch;
        window.showWebApp = showWebApp;
        window.tagFriend = tagFriend;
        window.tagFriendsInPost = tagFriendsInPost;
        window.toggleAccordion = toggleAccordion;
        window.toggleAIChat = toggleAIChat;
        window.toggleCommentLike = toggleCommentLike;
        window.toggleLike = toggleLike;
        window.togglePostOptions = togglePostOptions;
        window.toggleSidebar = toggleSidebar;
        window.viewMedia = viewMedia;
        window.viewProfile = viewProfile;
        window.viewProfileByUsername = viewProfileByUsername;
        window.viewStory = viewStory;
        window.watchAllStories = watchAllStories;

    </script>
</body>
</html>
